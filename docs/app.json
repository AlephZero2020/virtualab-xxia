[{"name":"app.R","content":"# VirtuaLAB XXI (Shinylive-safe)\r\n# NOTA: Solo CSV para descargas (sin Excel). Sin dependencias no soportadas.\r\n\r\nlibrary(shiny)\r\nlibrary(ggplot2)\r\nif (FALSE) {\r\n  library(munsell)\r\n}\r\nif (FALSE) {\r\n  library(tibble)\r\n  library(munsell)\r\n}\r\n\r\nlibrary(shiny)\r\nlibrary(ggplot2)\r\n\r\nui <- fluidPage(\r\n  withMathJax(),\r\n  tags$head(\r\n    tags$style(HTML(\"\r\n      body { background:#f4f6f9; margin:0; }\r\n      .app-header{\r\n        background:#3c8dbc; color:white; padding:14px 18px;\r\n        font-size:20px; font-weight:700; border-radius:8px;\r\n        margin:12px 12px 0 12px;\r\n      }\r\n      .app-header .alpha{ color:#FFD700; font-size:26px; font-weight:800; margin-left:6px; }\r\n\r\n      .sidebar{\r\n        background:#222d32; color:#b8c7ce;\r\n        min-height: calc(100vh - 92px);\r\n        border-radius:8px;\r\n        padding:10px 0;\r\n      }\r\n      .sidebar a{\r\n        display:block; padding:10px 16px;\r\n        color:#b8c7ce; text-decoration:none;\r\n        font-size:14px;\r\n      }\r\n      .sidebar a:hover{ background:#1e282c; color:white; }\r\n      .sidebar a.active{ background:#1e282c; color:white; border-left:4px solid #3c8dbc; padding-left:12px; }\r\n\r\n      .content-wrap{ padding:12px; }\r\n\r\n      .box{\r\n        background:white; border-radius:8px;\r\n        border:1px solid #d9e6f5;\r\n        box-shadow:0 1px 2px rgba(0,0,0,.05);\r\n        margin-bottom:14px;\r\n      }\r\n      .box .box-header{\r\n        padding:10px 14px;\r\n        border-bottom:1px solid #e6f0ff;\r\n        font-weight:700;\r\n        background:#3c8dbc;\r\n        color:white;\r\n        border-top-left-radius:8px;\r\n        border-top-right-radius:8px;\r\n      }\r\n      .box .box-body{ padding:14px; }\r\n\r\n      /* Oculta la barra de tabs (pero sin romper su funcionamiento) */\r\n      .nav-tabs{\r\n        visibility: hidden;\r\n        height: 0 !important;\r\n        overflow: hidden;\r\n        margin: 0 !important;\r\n        padding: 0 !important;\r\n        border: 0 !important;\r\n      }\r\n\r\n      .result-box { margin-top:10px; padding:14px; background:#f5faff; border:1px solid #cfe3ff; border-radius:8px; }\r\n\r\n      .sample-scroll {\r\n        height: 340px;\r\n        overflow-y: scroll;\r\n        border: 1px solid #cfe3ff;\r\n        background: white;\r\n        padding: 8px;\r\n        border-radius: 8px;\r\n      }\r\n\r\n      .formula-box { background: #ffffff; padding: 14px; border-radius: 8px; border: 1px solid #d9e6f5; margin-top: 10px; }\r\n\r\n      mjx-container { font-family: 'Times New Roman', Times, serif !important; }\r\n      \r\n      /* === X. Glosario y simbolog√≠a === */\r\n.glossary-wrap { font-family: 'Times New Roman', Times, serif; }\r\ntable.glossary-table { width:100%; border-collapse:collapse; font-size:15px; background:white; }\r\ntable.glossary-table th, table.glossary-table td { border:1px solid #cfe3ff; padding:10px; vertical-align:top; }\r\ntable.glossary-table th { background:#f5faff; font-weight:700; text-align:left; }\r\n.math-serif-bold { font-family: serif; font-weight:700; }\r\n.math-serif-bold-italic { font-family: serif; font-weight:700; font-style:italic; }\r\n.pedagogic-note { margin-top:14px; padding:12px 14px; border-left:5px solid #777; background:#fafafa; border-radius:8px; }\r\n.pedagogic-note .title { font-weight:700; margin-bottom:8px; }\r\n.pedagogic-note .mathline { margin:6px 0; text-align:center; font-size:16px; }\r\n      \r\n    \")),\r\n    tags$script(HTML(\"\r\n  // Descarga de texto (CSV) sin servidor: crea un Blob y fuerza download\r\n  Shiny.addCustomMessageHandler('download_text_file', function(msg) {\r\n    try {\r\n      var blob = new Blob([msg.content], { type: msg.mime || 'text/csv;charset=utf-8' });\r\n      var url = URL.createObjectURL(blob);\r\n\r\n      var a = document.createElement('a');\r\n      a.href = url;\r\n      a.download = msg.filename || 'archivo.csv';\r\n      document.body.appendChild(a);\r\n      a.click();\r\n\r\n      setTimeout(function() {\r\n        document.body.removeChild(a);\r\n        URL.revokeObjectURL(url);\r\n      }, 0);\r\n    } catch (e) {\r\n      console.error('download_text_file failed', e);\r\n      alert('No se pudo generar la descarga en este navegador.');\r\n    }\r\n  });\r\n\"))\r\n    \r\n  ),\r\n  \r\n  div(class=\"app-header\", HTML(\"VirtuaLAB XXI <span class='alpha'>ùõº<\/span>\")),\r\n  \r\n  sidebarLayout(\r\n    sidebarPanel(\r\n      width = 3,\r\n      div(\r\n        class=\"sidebar\",\r\n        tags$a(\"I. Presentaci√≥n\", href=\"#\", `data-tab`=\"intro\", class=\"active\"),\r\n        tags$a(\"II. Poblaci√≥n\", href=\"#\", `data-tab`=\"poblacion\"),\r\n        tags$a(\"III. Variable cualitativa\", href=\"#\", `data-tab`=\"var_cuali\"),\r\n        tags$a(\"IV. Variable cuantitativa\", href=\"#\", `data-tab`=\"var_cuanti\"),\r\n        tags$a(\"V. Marco Muestral\", href=\"#\", `data-tab`=\"marco\"),\r\n        tags$a(\"VI. Noci√≥n de muestreo\", href=\"#\", `data-tab`=\"nocion\"),\r\n        tags$a(\"VII. Muestreo aleatorio\", href=\"#\", `data-tab`=\"muestreo_vii\"),\r\n        tags$a(\"VIII. An√°lisis descriptivo e Inferencia\", href=\"#\", `data-tab`=\"inferencia_viii\"),\r\n        tags$a(\"IX. Interpretaci√≥n de la inferencia\", href=\"#\", `data-tab`=\"interpretacion_ix\"),\r\n        tags$a(\"X. Glosario y simbolog√≠a\", href=\"#\", `data-tab`=\"glosario_x\")\r\n      ),\r\n      tags$script(HTML(\"\r\n        $(document).on('click', '.sidebar a', function(e){\r\n          e.preventDefault();\r\n          $('.sidebar a').removeClass('active');\r\n          $(this).addClass('active');\r\n          var tab = $(this).data('tab');\r\n          $('.nav-tabs a[data-value=' + tab + ']').tab('show');\r\n        });\r\n\r\n        // Forzar tab inicial al cargar\r\n        $(function(){\r\n          $('.nav-tabs a[data-value=\\\"intro\\\"]').tab('show');\r\n        });\r\n      \"))\r\n    ),\r\n    \r\n    mainPanel(\r\n      width = 9,\r\n      div(\r\n        class=\"content-wrap\",\r\n        tabsetPanel(\r\n          id = \"tabs_main\",\r\n          selected = \"intro\",\r\n          \r\n          # =========================\r\n          # I. PRESENTACI√ìN\r\n          # =========================\r\n          tabPanel(\r\n            title = \"I. Presentaci√≥n\",\r\n            value = \"intro\",\r\n            div(\r\n              class=\"box\",\r\n              div(class=\"box-header\", \"I. Introducci√≥n\"),\r\n              div(\r\n                class=\"box-body\",\r\n                tags$div(\r\n                  style = \"\r\n                    background:#ffffff;\r\n                    border:1px solid #d9e6f5;\r\n                    border-radius:10px;\r\n                    padding:40px 60px;\r\n                    font-family: Arial, Helvetica, sans-serif;\r\n                    font-size:22px;\r\n                    line-height:1.8;\r\n                  \",\r\n                  tags$div(\r\n                    style = \"font-size:40px; font-weight:400; margin-bottom:14px; color:#1F3A5F;\",\r\n                    HTML(\"VirtuaLAB XXI <span style='font-weight:400;'>(Alpha)<\/span>\")\r\n                  ),\r\n                  tags$div(\r\n                    style = \"font-size:26px; margin-bottom:24px; color:#4682B4;\",\r\n                    \"Laboratorio virtual para el estudio de la estad√≠stica.\"\r\n                  ),\r\n                  tags$hr(style = \"margin:20px 0 26px 0; border-top:1px solid #e6f0ff;\"),\r\n                  tags$div(\r\n                    style = \"font-size:22px; color:#4682B4;\",\r\n                    HTML(\r\n                      \"Desarrollado por <b>Ver√≥nica del Carmen Quijada Monroy<\/b> y <b>V√≠ctor Manuel Ulloa<\/b> como parte del <b>Proyecto PE14226<\/b>, dentro del <b>Programa de Apoyo a Proyectos para Innovar y Mejorar la Educaci√≥n<\/b>, de la <b>Universidad Nacional Aut√≥noma de M√©xico<\/b>.\"\r\n                    )\r\n                  )\r\n                )\r\n              )\r\n            )\r\n          ),\r\n          \r\n          # =========================\r\n          # II. POBLACI√ìN\r\n          # =========================\r\n          tabPanel(\r\n            title = \"II. Poblaci√≥n\",\r\n            value = \"poblacion\",\r\n            div(\r\n              class=\"box\",\r\n              div(class=\"box-header\", \"II. Poblaci√≥n\"),\r\n              div(class=\"box-body\",\r\n                  plotOutput(\"poblacionPlot\", height = \"520px\")\r\n              )\r\n            )\r\n          ),\r\n          \r\n          # =========================\r\n          # III. VARIABLE CUALITATIVA\r\n          # =========================\r\n          tabPanel(\r\n            title = \"III. Variable cualitativa\",\r\n            value = \"var_cuali\",\r\n            div(\r\n              class=\"box\",\r\n              div(class=\"box-header\", \"III. Variable cualitativa\"),\r\n              div(\r\n                class=\"box-body\",\r\n                fluidRow(\r\n                  column(6, plotOutput(\"poblacionPlot_cuali\", height = \"520px\")),\r\n                  column(6, plotOutput(\"donaPob_cuali\", height = \"520px\"))\r\n                ),\r\n                uiOutput(\"tablaProps_cuali\")\r\n              )\r\n            )\r\n          ),\r\n          \r\n          # =========================\r\n          # IV. VARIABLE CUANTITATIVA\r\n          # =========================\r\n          tabPanel(\r\n            title = \"IV. Variable cuantitativa\",\r\n            value = \"var_cuanti\",\r\n            div(\r\n              class=\"box\",\r\n              div(class=\"box-header\", \"IV. Variable cuantitativa\"),\r\n              div(\r\n                class=\"box-body\",\r\n                fluidRow(\r\n                  column(6, plotOutput(\"poblacionPlot_cuanti\", height = \"520px\")),\r\n                  column(6, plotOutput(\"histPob_cuanti\", height = \"520px\"))\r\n                ),\r\n                uiOutput(\"tablaMediaVar_cuanti\")\r\n              )\r\n            )\r\n          ),\r\n          \r\n          # =========================\r\n          # V. MARCO MUESTRAL\r\n          # =========================\r\n          tabPanel(\r\n            title = \"V. Marco Muestral\",\r\n            value = \"marco\",\r\n            div(\r\n              class=\"box\",\r\n              div(class=\"box-header\", \"V. Marco Muestral\"),\r\n              div(\r\n                class=\"box-body\",\r\n                fluidRow(\r\n                  column(\r\n                    4,\r\n                    h4(\"Explorar registros\"),\r\n                    tags$div(\r\n                      style=\"font-size:13px; color:#555; margin-top:6px;\",\r\n                      \"Deslice verticalmente para recorrer el marco muestral.\"\r\n                    ),\r\n                    hr(),\r\n                    actionButton(\"desc_poblacion_marco\", \"Descargar poblaci√≥n (CSV)\", class = \"btn-block\")\r\n                  ),\r\n                  column(\r\n                    8,\r\n                    div(\r\n                      class = \"sample-scroll\",\r\n                      tableOutput(\"tabla_marco\")\r\n                    )\r\n                  )\r\n                )\r\n              )\r\n            )\r\n          ),\r\n          \r\n          # =========================\r\n          # VI. NOCI√ìN DE MUESTREO\r\n          # =========================\r\n          tabPanel(\r\n            title = \"VI. Noci√≥n de muestreo\",\r\n            value = \"nocion\",\r\n            div(\r\n              class=\"box\",\r\n              div(class=\"box-header\", \"VI. Noci√≥n de muestreo\"),\r\n              div(\r\n                class=\"box-body\",\r\n                sidebarLayout(\r\n                  sidebarPanel(\r\n                    h4(\"Tipo de variable\"),\r\n                    radioButtons(\r\n                      \"tipo_var_vi\",\r\n                      label = NULL,\r\n                      choices = c(\"Cualitativa (color)\" = \"cuali\", \"Cuantitativa (di√°metro)\" = \"cuanti\"),\r\n                      selected = \"cuali\"\r\n                    ),\r\n                    hr(),\r\n                    \r\n                    conditionalPanel(\r\n                      condition = \"input.tipo_var_vi == 'cuali'\",\r\n                      h4(\"Muestreo\"),\r\n                      sliderInput(\"n_muestra_cuali_vi\", \"Tama√±o de muestra (n):\",\r\n                                  min = 10, max = 2000, value = 10, step = 10),\r\n                      actionButton(\"nueva_muestra_cuali_vi\", \"Nueva muestra\")\r\n                    ),\r\n                    \r\n                    conditionalPanel(\r\n                      condition = \"input.tipo_var_vi == 'cuanti'\",\r\n                      h4(\"Muestreo\"),\r\n                      sliderInput(\"n_muestra_cuanti_vi\", \"Tama√±o de muestra (n):\",\r\n                                  min = 10, max = 2000, value = 10, step = 10),\r\n                      actionButton(\"nueva_muestra_cuanti_vi\", \"Nueva muestra\")\r\n                    )\r\n                  ),\r\n                  \r\n                  mainPanel(\r\n                    conditionalPanel(\r\n                      condition = \"input.tipo_var_vi == 'cuali'\",\r\n                      fluidRow(\r\n                        column(6, plotOutput(\"poblacionPlot_cuali_vi\", height = \"520px\")),\r\n                        column(6, plotOutput(\"muestraPlot_cuali_vi\", height = \"520px\"))\r\n                      ),\r\n                      hr(),\r\n                      fluidRow(\r\n                        column(6, plotOutput(\"donaPob_cuali_vi\", height = \"320px\")),\r\n                        column(6, plotOutput(\"donaMue_cuali_vi\", height = \"320px\"))\r\n                      ),\r\n                      uiOutput(\"tablaProps_cuali_vi\")\r\n                    ),\r\n                    \r\n                    conditionalPanel(\r\n                      condition = \"input.tipo_var_vi == 'cuanti'\",\r\n                      fluidRow(\r\n                        column(6, plotOutput(\"poblacionPlot_cuanti_vi\", height = \"520px\")),\r\n                        column(6, plotOutput(\"muestraPlot_cuanti_vi\", height = \"520px\"))\r\n                      ),\r\n                      hr(),\r\n                      fluidRow(\r\n                        column(6, plotOutput(\"histPob_cuanti_vi\", height = \"320px\")),\r\n                        column(6, plotOutput(\"histMue_cuanti_vi\", height = \"320px\"))\r\n                      ),\r\n                      uiOutput(\"tablaMediaVar_cuanti_vi\")\r\n                    )\r\n                  )\r\n                )\r\n              )\r\n            )\r\n          ),\r\n          \r\n          # =========================\r\n          # VII. MUESTREO ALEATORIO\r\n          # =========================\r\n          tabPanel(\r\n            title = \"VII. Muestreo aleatorio\",\r\n            value = \"muestreo_vii\",\r\n            div(\r\n              class=\"box\",\r\n              div(class=\"box-header\", \"VII. Muestreo aleatorio\"),\r\n              div(\r\n                class=\"box-body\",\r\n                sidebarLayout(\r\n                  sidebarPanel(\r\n                    h4(\"Tipo de variable\"),\r\n                    radioButtons(\r\n                      \"tipo_var_vii\",\r\n                      label = NULL,\r\n                      choices = c(\"Cualitativa (color)\" = \"cuali\", \"Cuantitativa (di√°metro)\" = \"cuanti\"),\r\n                      selected = \"cuali\"\r\n                    ),\r\n                    hr(),\r\n                    \r\n                    h4(\"Par√°metros de dise√±o\"),\r\n                    sliderInput(\"conf_vii\", \"Nivel de confianza (%)\",\r\n                                min = 10, max = 99, value = 10, step = 1),\r\n                    sliderInput(\"err_vii\", \"Margen de error (%)\",\r\n                                min = 1, max = 20, value = 5, step = 1),\r\n                    \r\n                    conditionalPanel(\r\n                      condition = \"input.tipo_var_vii == 'cuanti'\",\r\n                      sliderInput(\"var_pob_vii\", \"Varianza (poblaci√≥n) usada en el c√°lculo\",\r\n                                  min = 0.10, max = 50, value = 1, step = 0.10)\r\n                    ),\r\n                    \r\n                    uiOutput(\"vii_formula\"),\r\n                    uiOutput(\"vii_valores\"),\r\n                    \r\n                    hr(),\r\n                    actionButton(\"vii_nueva_muestra\", \"Nueva muestra\", class = \"btn-primary btn-block\"),\r\n                    actionButton(\"vii_descargar_csv\", \"Descargar muestra (CSV)\", class = \"btn-block\")\r\n                  ),\r\n                  \r\n                  mainPanel(\r\n                    conditionalPanel(\r\n                      condition = \"input.tipo_var_vii == 'cuali'\",\r\n                      fluidRow(\r\n                        column(6, plotOutput(\"poblacionPlot_cuali_vii\", height = \"520px\")),\r\n                        column(6, plotOutput(\"muestraPlot_cuali_vii\", height = \"520px\"))\r\n                      ),\r\n                      hr(),\r\n                      fluidRow(\r\n                        column(6, plotOutput(\"donaPob_cuali_vii\", height = \"320px\")),\r\n                        column(6, plotOutput(\"donaMue_cuali_vii\", height = \"320px\"))\r\n                      ),\r\n                      uiOutput(\"tablaProps_cuali_vii\"),\r\n                      hr(),\r\n                      h4(\"Dataframe de la muestra (ID + Color)\"),\r\n                      div(class = \"sample-scroll\", tableOutput(\"tabla_muestra_vii_cuali\"))\r\n                    ),\r\n                    \r\n                    conditionalPanel(\r\n                      condition = \"input.tipo_var_vii == 'cuanti'\",\r\n                      fluidRow(\r\n                        column(6, plotOutput(\"poblacionPlot_cuanti_vii\", height = \"520px\")),\r\n                        column(6, plotOutput(\"muestraPlot_cuanti_vii\", height = \"520px\"))\r\n                      ),\r\n                      hr(),\r\n                      fluidRow(\r\n                        column(6, plotOutput(\"histPob_cuanti_vii\", height = \"320px\")),\r\n                        column(6, plotOutput(\"histMue_cuanti_vii\", height = \"320px\"))\r\n                      ),\r\n                      uiOutput(\"tablaMediaVar_cuanti_vii\"),\r\n                      hr(),\r\n                      h4(\"Dataframe de la muestra (ID + Di√°metro)\"),\r\n                      div(class = \"sample-scroll\", tableOutput(\"tabla_muestra_vii_cuanti\"))\r\n                    )\r\n                  )\r\n                )\r\n              )\r\n            )\r\n          ),\r\n          \r\n          # =========================\r\n          # VIII. AN√ÅLISIS DESCRIPTIVO E INFERENCIA (solo muestra)\r\n          # =========================\r\n          tabPanel(\r\n            title = \"VIII. An√°lisis descriptivo e Inferencia\",\r\n            value = \"inferencia_viii\",\r\n            div(\r\n              class=\"box\",\r\n              div(class=\"box-header\", \"VIII. An√°lisis descriptivo e Inferencia\"),\r\n              div(\r\n                class=\"box-body\",\r\n                sidebarLayout(\r\n                  sidebarPanel(\r\n                    h4(\"Tipo de variable\"),\r\n                    radioButtons(\r\n                      \"tipo_var_viii\",\r\n                      label = NULL,\r\n                      choices = c(\"Cualitativa (color)\" = \"cuali\", \"Cuantitativa (di√°metro)\" = \"cuanti\"),\r\n                      selected = \"cuali\"\r\n                    ),\r\n                    hr(),\r\n                    \r\n                    h4(\"Par√°metros de dise√±o\"),\r\n                    sliderInput(\"conf_viii\", \"Nivel de confianza (%)\",\r\n                                min = 10, max = 99, value = 10, step = 1),\r\n                    sliderInput(\"err_viii\", \"Margen de error (%)\",\r\n                                min = 1, max = 20, value = 5, step = 1),\r\n                    \r\n                    conditionalPanel(\r\n                      condition = \"input.tipo_var_viii == 'cuanti'\",\r\n                      sliderInput(\"var_pob_viii\", \"Varianza (poblaci√≥n) usada en el c√°lculo\",\r\n                                  min = 0.10, max = 50, value = 1, step = 0.10)\r\n                    ),\r\n                    \r\n                    uiOutput(\"viii_formula\"),\r\n                    uiOutput(\"viii_valores\"),\r\n                    \r\n                    hr(),\r\n                    actionButton(\"viii_nueva_muestra\", \"Nueva muestra\", class = \"btn-primary btn-block\")\r\n                  ),\r\n                  \r\n                  mainPanel(\r\n                    conditionalPanel(\r\n                      condition = \"input.tipo_var_viii == 'cuali'\",\r\n                      \r\n                      fluidRow(\r\n                        column(6, plotOutput(\"muestraPlot_cuali_viii\", height = \"260px\")),\r\n                        column(6, plotOutput(\"donaMue_cuali_viii\", height = \"260px\"))\r\n                      ),\r\n                      \r\n                      hr(),\r\n                      uiOutput(\"viii_formulas_stats\"),\r\n                      uiOutput(\"viii_resultados_cuali\"),\r\n                      uiOutput(\"viii_ic_cuali\"),\r\n                      hr(),\r\n                      h4(\"Dataframe de la muestra (ID + Color)\"),\r\n                      div(class = \"sample-scroll\", tableOutput(\"tabla_muestra_viii_cuali\"))\r\n                    ),\r\n                    \r\n                    conditionalPanel(\r\n                      condition = \"input.tipo_var_viii == 'cuanti'\",\r\n                      \r\n                      fluidRow(\r\n                        column(6, plotOutput(\"muestraPlot_cuanti_viii\", height = \"260px\")),\r\n                        column(6, plotOutput(\"histMue_cuanti_viii\", height = \"260px\"))\r\n                      ),\r\n                      \r\n                      hr(),\r\n                      uiOutput(\"viii_formulas_stats\"),\r\n                      uiOutput(\"viii_resultados_cuanti\"),\r\n                      uiOutput(\"viii_ic_cuanti\"),\r\n                      hr(),\r\n                      h4(\"Dataframe de la muestra (ID + Di√°metro)\"),\r\n                      div(class = \"sample-scroll\", tableOutput(\"tabla_muestra_viii_cuanti\"))\r\n                    )\r\n                  )\r\n                )\r\n              )\r\n            )\r\n          ),\r\n          # =========================\r\n          # IX. INTERPRETACI√ìN DE LA INFERENCIA\r\n          # =========================\r\n          tabPanel(\r\n            title = \"IX. Interpretaci√≥n de la inferencia\",\r\n            value = \"interpretacion_ix\",\r\n            div(\r\n              class=\"box\",\r\n              div(class=\"box-header\", \"IX. Interpretaci√≥n de la inferencia\"),\r\n              div(\r\n                class=\"box-body\",\r\n                sidebarLayout(\r\n                  sidebarPanel(\r\n                    h4(\"Par√°metro poblacional\"),\r\n                    radioButtons(\r\n                      \"ix_param\",\r\n                      label = NULL,\r\n                      choices = c(\"Proporci√≥n (color)\" = \"prop\", \"Media (di√°metro)\" = \"media\"),\r\n                      selected = \"prop\"\r\n                    ),\r\n                    \r\n                    conditionalPanel(\r\n                      condition = \"input.ix_param == 'prop'\",\r\n                      selectInput(\r\n                        \"ix_color_obj\",\r\n                        \"Color de inter√©s (√©xito):\",\r\n                        choices = c(\"Azul\", \"Naranja\", \"Verde\"),\r\n                        selected = \"Azul\"\r\n                      )\r\n                    ),\r\n                    \r\n                    hr(),\r\n                    h4(\"Dise√±o del intervalo\"),\r\n                    sliderInput(\r\n                      \"ix_conf\",\r\n                      \"Nivel de confianza (1 ‚àí Œ±)\",\r\n                      min = 0.10, max = 0.99, value = 0.10, step = 0.01\r\n                    ),\r\n                    \r\n                    conditionalPanel(\r\n                      condition = \"input.ix_param == 'prop'\",\r\n                      sliderInput(\r\n                        \"ix_E_prop\",\r\n                        \"Margen de error (E)\",\r\n                        min = 0.01, max = 0.20, value = 0.05, step = 0.01\r\n                      )\r\n                    ),\r\n                    conditionalPanel(\r\n                      condition = \"input.ix_param == 'media'\",\r\n                      sliderInput(\r\n                        \"ix_E_med\",\r\n                        \"Margen de error (E)\",\r\n                        min = 0.10, max = 5.00, value = 1.00, step = 0.10\r\n                      )\r\n                    ),\r\n                    \r\n                    hr(),\r\n                    h4(\"Tama√±o de muestra (poblaci√≥n finita)\"),\r\n                    uiOutput(\"ix_formula\"),\r\n                    uiOutput(\"ix_sustitucion\"),\r\n                    uiOutput(\"ix_n_txt\"),\r\n                    \r\n                    hr(),\r\n                    h4(\"Experimento de cobertura\"),\r\n                    sliderInput(\r\n                      \"ix_B\",\r\n                      \"N√∫mero de intervalos (B)\",\r\n                      min = 50, max = 500, value = 100, step = 50\r\n                    ),\r\n                    \r\n                    actionButton(\"ix_recalcular\", \"Repetir experimento\", class = \"btn-primary btn-block\")\r\n                  ),\r\n                  \r\n                  mainPanel(\r\n                    plotOutput(\"ix_plot_ic\", height = \"420px\"),\r\n                    uiOutput(\"ix_resumen\"),\r\n                    \r\n                    div(\r\n                      class = \"box\",\r\n                      div(class = \"box-header\", \"Interpretaci√≥n del experimento\"),\r\n                      div(\r\n                        class = \"box-body\",\r\n                        tags$ul(\r\n                          tags$li(HTML(\"<b>Cada barra<\/b> representa un intervalo de confianza construido con una muestra distinta.\")),\r\n                          tags$li(HTML(\"<b>Verde<\/b>: el intervalo <b>s√≠<\/b> contiene al par√°metro poblacional.\")),\r\n                          tags$li(HTML(\"<b>Rojo<\/b>: el intervalo <b>no<\/b> contiene al par√°metro poblacional.\"))\r\n                        ),\r\n                        uiOutput(\"ix_pct_captura\")\r\n                      )\r\n                    )\r\n                  )\r\n                )\r\n              )\r\n            )\r\n          ),\r\n          # =========================\r\n          # X. GLOSARIO Y SIMBOLOG√çA\r\n          # =========================\r\n          tabPanel(\r\n            title = \"X. Glosario y simbolog√≠a\",\r\n            value = \"glosario_x\",\r\n            div(\r\n              class=\"box\",\r\n              div(class=\"box-header\", \"X. Glosario y simbolog√≠a\"),\r\n              div(\r\n                class=\"box-body\",\r\n                uiOutput(\"glosario_ui\")\r\n              )\r\n            )\r\n          )\r\n        )\r\n      )\r\n    )\r\n  )\r\n)\r\n\r\nserver <- function(input, output, session) {\r\n  \r\n  # ============================================================\r\n  # POBLACI√ìN √öNICA (2000 bolas)\r\n  # ============================================================\r\n  N <- 2000\r\n  n_col <- 40\r\n  n_row <- ceiling(N / n_col)\r\n  \r\n  coords <- expand.grid(col = 1:n_col, row = 1:n_row)\r\n  coords <- coords[1:N, ]\r\n  \r\n  cols <- c(\r\n    \"Azul\"    = \"#1f77b4\",\r\n    \"Naranja\" = \"#ff7f0e\",\r\n    \"Verde\"   = \"#2ca02c\"\r\n  )\r\n  \r\n  w <- runif(3, min = 0.2, max = 1.2)\r\n  probs <- w / sum(w)\r\n  \r\n  colores <- sample(\r\n    x = names(cols),\r\n    size = N,\r\n    replace = TRUE,\r\n    prob = probs\r\n  )\r\n  \r\n  diam_raw <- rnorm(N, mean = 1.0, sd = 0.25)\r\n  diam_raw[diam_raw < 0.4] <- 0.4\r\n  diam_raw[diam_raw > 1.8] <- 1.8\r\n  \r\n  poblacion <- data.frame(\r\n    id    = 1:N,\r\n    x     = coords$col,\r\n    y     = -coords$row,\r\n    color = factor(colores, levels = names(cols)),\r\n    diam  = diam_raw\r\n  )\r\n  \r\n  # Evita depender de scales::rescale\r\n  rescale01 <- function(x) {\r\n    r <- range(x, finite = TRUE)\r\n    if (r[2] - r[1] == 0) return(rep(0.5, length(x)))\r\n    (x - r[1]) / (r[2] - r[1])\r\n  }\r\n  poblacion$size_pt <- 1.6 + rescale01(poblacion$diam) * (4.2 - 1.6)\r\n  \r\n  set.seed(999)\r\n  sigma_med <- 0.55\r\n  diam_did <- poblacion$diam + rnorm(N, mean = 0, sd = sigma_med)\r\n  diam_did <- pmin(pmax(diam_did, 0.2), 2.4)\r\n  poblacion$diam_did <- diam_did\r\n  \r\n  xlim_all <- c(0.5, n_col + 0.5)\r\n  ylim_all <- c(-n_row - 0.5, -0.5)\r\n  \r\n  ESCALA <- 10\r\n  \r\n  # =========================\r\n  # HELPERS\r\n  # =========================\r\n  plot_poblacion_bolas <- function(titulo) {\r\n    ggplot(poblacion, aes(x, y)) +\r\n      geom_point(\r\n        aes(fill = color, size = size_pt),\r\n        shape = 21,\r\n        color = \"gray25\",\r\n        stroke = 0.15,\r\n        alpha = 0.85\r\n      ) +\r\n      scale_fill_manual(values = cols) +\r\n      scale_size_identity() +\r\n      coord_equal(xlim = xlim_all, ylim = ylim_all, expand = FALSE) +\r\n      labs(title = titulo) +\r\n      theme_void(base_size = 14) +\r\n      theme(plot.title = element_text(face = \"bold\"),\r\n            legend.position = \"none\")\r\n  }\r\n  \r\n  donut_plot <- function(df_props, col_value_name, titulo = NULL) {\r\n    df <- data.frame(\r\n      categoria = df_props$categoria,\r\n      valor = df_props[[col_value_name]],\r\n      stringsAsFactors = FALSE\r\n    )\r\n    df$frac <- df$valor / sum(df$valor)\r\n    df$ymax <- cumsum(df$frac)\r\n    df$ymin <- c(0, head(df$ymax, -1))\r\n    \r\n    p <- ggplot(df, aes(ymax = ymax, ymin = ymin, xmax = 4, xmin = 2, fill = categoria)) +\r\n      geom_rect(color = \"white\", linewidth = 0.6) +\r\n      coord_polar(theta = \"y\") +\r\n      xlim(0, 4.5) +\r\n      scale_fill_manual(values = cols) +\r\n      theme_void(base_size = 14) +\r\n      theme(\r\n        legend.position = \"none\",\r\n        plot.title = element_text(face = \"bold\", hjust = 0.5)\r\n      )\r\n    \r\n    if (!is.null(titulo)) p <- p + labs(title = titulo)\r\n    p\r\n  }\r\n  \r\n  hist_con_normal <- function(x, titulo) {\r\n    mu <- mean(x)\r\n    sdv <- sd(x)\r\n    ggplot(data.frame(val = x), aes(val)) +\r\n      geom_histogram(aes(y = ..density..),\r\n                     bins = 18,\r\n                     fill = \"#1f77b4\",\r\n                     color = \"white\",\r\n                     alpha = 0.75) +\r\n      stat_function(fun = dnorm,\r\n                    args = list(mean = mu, sd = sdv),\r\n                    color = \"red\",\r\n                    linewidth = 1.2) +\r\n      labs(title = titulo, x = \"Di√°metro\", y = \"Frecuencia-Densidad\") +\r\n      theme_minimal(base_size = 14) +\r\n      theme(panel.grid = element_blank(),\r\n            plot.title = element_text(face = \"bold\", hjust = 0.5))\r\n  }\r\n  \r\n  fpc <- function(N, n) {\r\n    if (n >= N) return(0)\r\n    sqrt((N - n) / (N - 1))\r\n  }\r\n  \r\n  skewness_simple <- function(x) {\r\n    x <- x[is.finite(x)]\r\n    if (length(x) < 3) return(NA_real_)\r\n    m <- mean(x); s <- sd(x)\r\n    if (s == 0) return(0)\r\n    mean((x - m)^3) / (s^3)\r\n  }\r\n  \r\n  kurtosis_excess_simple <- function(x) {\r\n    x <- x[is.finite(x)]\r\n    if (length(x) < 4) return(NA_real_)\r\n    m <- mean(x); s <- sd(x)\r\n    if (s == 0) return(0)\r\n    mean((x - m)^4) / (s^4) - 3\r\n  }\r\n  \r\n  # =========================\r\n  # II. POBLACI√ìN\r\n  # =========================\r\n  output$poblacionPlot <- renderPlot({\r\n    plot_poblacion_bolas(paste0(\"Poblaci√≥n (N = \", N, \")\"))\r\n  })\r\n  \r\n  # =========================\r\n  # III. VARIABLE CUALITATIVA\r\n  # =========================\r\n  output$poblacionPlot_cuali <- renderPlot({\r\n    plot_poblacion_bolas(paste0(\"Poblaci√≥n (N = \", N, \")\"))\r\n  })\r\n  \r\n  props_cuali_df <- reactive({\r\n    pob_tab <- prop.table(table(poblacion$color))\r\n    colores_all <- levels(poblacion$color)\r\n    pob_tab <- pob_tab[colores_all]\r\n    data.frame(\r\n      categoria = colores_all,\r\n      proporcion = as.numeric(pob_tab),\r\n      stringsAsFactors = FALSE\r\n    )\r\n  })\r\n  \r\n  output$donaPob_cuali <- renderPlot({\r\n    df <- props_cuali_df()\r\n    donut_plot(df, \"proporcion\", \"Proporci√≥n poblacional (por color)\")\r\n  })\r\n  \r\n  output$tablaProps_cuali <- renderUI({\r\n    df <- props_cuali_df()\r\n    tags$div(\r\n      class = \"result-box\",\r\n      tags$h4(\r\n        HTML(\r\n          \"Variable <span style='font-family:serif; font-weight:700; font-style:italic;'>X<\/span> = Color | Par√°metro investigado <span style='font-family:serif; font-weight:700;'>&theta;<\/span> = <span style='font-family:serif; font-weight:700;'>&pi;<\/span> (Proporci√≥n poblacional)\"\r\n        ),\r\n        style = \"margin-top:0;\"\r\n      ),\r\n      tags$table(\r\n        style = \"width:100%; border-collapse:collapse;\",\r\n        tags$thead(\r\n          tags$tr(\r\n            tags$th(\"Color\", style=\"text-align:left; border-bottom:2px solid #cfe3ff; padding:6px;\"),\r\n            tags$th(\r\n              HTML(\"<span style='font-family:serif; font-weight:700;'>&pi;<\/span> (Proporci√≥n)\"),\r\n              style=\"text-align:right; border-bottom:2px solid #cfe3ff; padding:6px;\"\r\n            )\r\n          )\r\n        ),\r\n        tags$tbody(\r\n          lapply(seq_len(nrow(df)), function(i) {\r\n            tags$tr(\r\n              tags$td(df$categoria[i], style=\"padding:6px; border-bottom:1px solid #e6f0ff;\"),\r\n              tags$td(sprintf(\"%.3f\", df$proporcion[i]),\r\n                      style=\"padding:6px; text-align:right; border-bottom:1px solid #e6f0ff;\")\r\n            )\r\n          })\r\n        )\r\n      )\r\n    )\r\n  })\r\n  \r\n  # =========================\r\n  # IV. VARIABLE CUANTITATIVA\r\n  # =========================\r\n  output$poblacionPlot_cuanti <- renderPlot({\r\n    plot_poblacion_bolas(paste0(\"Poblaci√≥n (N = \", N, \")\"))\r\n  })\r\n  \r\n  diam_calc_pob <- reactive({\r\n    poblacion$diam_did * ESCALA\r\n  })\r\n  \r\n  output$histPob_cuanti <- renderPlot({\r\n    hist_con_normal(diam_calc_pob(), \"Poblaci√≥n: histograma del di√°metro\")\r\n  })\r\n  \r\n  output$tablaMediaVar_cuanti <- renderUI({\r\n    x_p <- diam_calc_pob()\r\n    \r\n    df <- data.frame(\r\n      Estad√≠stico = c(\r\n        HTML(\"<span style='font-family:serif; font-weight:bold;'>&mu;<\/span> (Media)\"),\r\n        HTML(\"<span style='font-family:serif; font-weight:bold;'>&sigma;<sup>2<\/sup><\/span> (Varianza)\")\r\n      ),\r\n      Valor = c(mean(x_p), var(x_p)),\r\n      stringsAsFactors = FALSE\r\n    )\r\n    \r\n    tags$div(\r\n      class = \"result-box\",\r\n      tags$h4(\r\n        HTML(\"Variable <span style='font-family:serif; font-weight:bold; font-style:italic;'>X<\/span> = Di√°metro |\r\n        Par√°metro investigado\r\n        <span style='font-family:serif; font-weight:bold;'>&theta;<\/span> =\r\n        <span style='font-family:serif; font-weight:bold;'>&mu;<\/span> (Media poblacional)\"),\r\n        style=\"margin-top:0;\"\r\n      ),\r\n      tags$table(\r\n        style = \"width:100%; border-collapse:collapse;\",\r\n        tags$thead(\r\n          tags$tr(\r\n            tags$th(\"Par√°metros\", style=\"text-align:left; border-bottom:2px solid #cfe3ff; padding:6px;\"),\r\n            tags$th(\"Valor\", style=\"text-align:right; border-bottom:2px solid #cfe3ff; padding:6px;\")\r\n          )\r\n        ),\r\n        tags$tbody(\r\n          lapply(seq_len(nrow(df)), function(i) {\r\n            tags$tr(\r\n              tags$td(HTML(df$Estad√≠stico[i]),\r\n                      style=\"padding:6px; border-bottom:1px solid #e6f0ff;\"),\r\n              tags$td(sprintf(\"%.3f\", df$Valor[i]),\r\n                      style=\"padding:6px; text-align:right; border-bottom:1px solid #e6f0ff;\")\r\n            )\r\n          })\r\n        )\r\n      )\r\n    )\r\n  })\r\n  \r\n  # =========================\r\n  # V. MARCO MUESTRAL + DESCARGA CSV\r\n  # =========================\r\n  marco_df <- reactive({\r\n    data.frame(\r\n      ID = as.integer(poblacion$id),\r\n      Color = as.character(poblacion$color),\r\n      Diametro = round(poblacion$diam_did * ESCALA, 3),\r\n      stringsAsFactors = FALSE\r\n    )\r\n  })\r\n  \r\n  output$tabla_marco <- renderTable({\r\n    marco_df()\r\n  }, striped = TRUE, bordered = TRUE, spacing = \"xs\", rownames = FALSE, align = \"c\")\r\n  \r\n  observeEvent(input$desc_poblacion_marco, {\r\n    df <- marco_df()\r\n    csv_txt <- paste(capture.output(write.csv(df, row.names = FALSE, fileEncoding = \"UTF-8\")), collapse = \"\\n\")\r\n    \r\n    session$sendCustomMessage(\"download_text_file\", list(\r\n      filename = paste0(\"poblacion_\", Sys.Date(), \".csv\"),\r\n      content  = csv_txt,\r\n      mime     = \"text/csv;charset=utf-8\"\r\n    ))\r\n  })\r\n  \r\n  # ==========================================================\r\n  # VI. NOCI√ìN DE MUESTREO (tal cual)\r\n  # ==========================================================\r\n  sample_ids_cuali_vi <- reactiveVal(integer(0))\r\n  tomar_muestra_cuali_vi <- function() {\r\n    n <- min(as.integer(input$n_muestra_cuali_vi), N)\r\n    sample_ids_cuali_vi(sample(poblacion$id, size = n, replace = FALSE))\r\n  }\r\n  observeEvent(TRUE, { tomar_muestra_cuali_vi() }, once = TRUE)\r\n  observeEvent(input$n_muestra_cuali_vi, { tomar_muestra_cuali_vi() }, ignoreInit = TRUE)\r\n  observeEvent(input$nueva_muestra_cuali_vi, { tomar_muestra_cuali_vi() }, ignoreInit = TRUE)\r\n  \r\n  muestra_cuali_vi <- reactive({\r\n    ids <- sample_ids_cuali_vi()\r\n    req(length(ids) > 0)\r\n    poblacion[match(ids, poblacion$id), , drop = FALSE]\r\n  })\r\n  \r\n  output$poblacionPlot_cuali_vi <- renderPlot({\r\n    plot_poblacion_bolas(paste0(\"Poblaci√≥n (N = \", N, \")\"))\r\n  })\r\n  \r\n  output$muestraPlot_cuali_vi <- renderPlot({\r\n    m <- muestra_cuali_vi()\r\n    req(nrow(m) > 0)\r\n    \r\n    ggplot() +\r\n      geom_point(\r\n        data = poblacion, aes(x, y),\r\n        shape = 21, size = 2.2, fill = \"white\",\r\n        color = \"gray80\", stroke = 0.12, alpha = 0.20\r\n      ) +\r\n      geom_point(\r\n        data = m, aes(x, y, fill = color, size = size_pt),\r\n        shape = 21, color = \"gray15\", stroke = 0.20, alpha = 0.98\r\n      ) +\r\n      scale_fill_manual(values = cols) +\r\n      scale_size_identity() +\r\n      coord_equal(xlim = xlim_all, ylim = ylim_all, expand = FALSE) +\r\n      labs(title = paste0(\"Muestra (n = \", nrow(m), \")\")) +\r\n      theme_void(base_size = 14) +\r\n      theme(plot.title = element_text(face = \"bold\"),\r\n            legend.position = \"none\")\r\n  })\r\n  \r\n  props_cuali_vi_df <- reactive({\r\n    m <- muestra_cuali_vi()\r\n    req(nrow(m) > 0)\r\n    \r\n    pob_tab <- prop.table(table(poblacion$color))\r\n    mue_tab <- prop.table(table(m$color))\r\n    \r\n    colores_all <- levels(poblacion$color)\r\n    pob_tab <- pob_tab[colores_all]\r\n    mue_tab <- mue_tab[colores_all]\r\n    mue_tab[is.na(mue_tab)] <- 0\r\n    \r\n    data.frame(\r\n      categoria = colores_all,\r\n      poblacion = as.numeric(pob_tab),\r\n      muestra = as.numeric(mue_tab),\r\n      stringsAsFactors = FALSE\r\n    )\r\n  })\r\n  \r\n  output$donaPob_cuali_vi <- renderPlot({\r\n    df <- props_cuali_vi_df()\r\n    donut_plot(data.frame(categoria = df$categoria, poblacion = df$poblacion), \"poblacion\",\r\n               \"Proporci√≥n poblacional (por color)\")\r\n  })\r\n  \r\n  output$donaMue_cuali_vi <- renderPlot({\r\n    df <- props_cuali_vi_df()\r\n    donut_plot(data.frame(categoria = df$categoria, muestra = df$muestra), \"muestra\",\r\n               \"Proporci√≥n muestral (por color)\")\r\n  })\r\n  \r\n  output$tablaProps_cuali_vi <- renderUI({\r\n    df <- props_cuali_vi_df()\r\n    tags$div(\r\n      class = \"result-box\",\r\n      tags$h4(\"Comparaci√≥n: proporci√≥n poblacional vs proporci√≥n muestral\", style=\"margin-top:0;\"),\r\n      tags$table(\r\n        style = \"width:100%; border-collapse:collapse;\",\r\n        tags$thead(\r\n          tags$tr(\r\n            tags$th(\"Categor√≠a (color)\", style=\"text-align:left; border-bottom:2px solid #cfe3ff; padding:6px;\"),\r\n            tags$th(\"Poblaci√≥n\", style=\"text-align:right; border-bottom:2px solid #cfe3ff; padding:6px;\"),\r\n            tags$th(\"Muestra\", style=\"text-align:right; border-bottom:2px solid #cfe3ff; padding:6px;\")\r\n          )\r\n        ),\r\n        tags$tbody(\r\n          lapply(seq_len(nrow(df)), function(i) {\r\n            tags$tr(\r\n              tags$td(df$categoria[i], style=\"padding:6px; border-bottom:1px solid #e6f0ff;\"),\r\n              tags$td(sprintf(\"%.3f\", df$poblacion[i]), style=\"padding:6px; text-align:right; border-bottom:1px solid #e6f0ff;\"),\r\n              tags$td(sprintf(\"%.3f\", df$muestra[i]), style=\"padding:6px; text-align:right; border-bottom:1px solid #e6f0ff;\")\r\n            )\r\n          })\r\n        )\r\n      )\r\n    )\r\n  })\r\n  \r\n  sample_ids_cuanti_vi <- reactiveVal(integer(0))\r\n  tomar_muestra_cuanti_vi <- function() {\r\n    n <- min(as.integer(input$n_muestra_cuanti_vi), N)\r\n    sample_ids_cuanti_vi(sample(poblacion$id, size = n, replace = FALSE))\r\n  }\r\n  observeEvent(TRUE, { tomar_muestra_cuanti_vi() }, once = TRUE)\r\n  observeEvent(input$n_muestra_cuanti_vi, { tomar_muestra_cuanti_vi() }, ignoreInit = TRUE)\r\n  observeEvent(input$nueva_muestra_cuanti_vi, { tomar_muestra_cuanti_vi() }, ignoreInit = TRUE)\r\n  \r\n  muestra_cuanti_vi <- reactive({\r\n    ids <- sample_ids_cuanti_vi()\r\n    req(length(ids) > 0)\r\n    poblacion[match(ids, poblacion$id), , drop = FALSE]\r\n  })\r\n  \r\n  output$poblacionPlot_cuanti_vi <- renderPlot({\r\n    plot_poblacion_bolas(paste0(\"Poblaci√≥n (N = \", N, \")\"))\r\n  })\r\n  \r\n  output$muestraPlot_cuanti_vi <- renderPlot({\r\n    m <- muestra_cuanti_vi()\r\n    req(nrow(m) > 0)\r\n    \r\n    ggplot() +\r\n      geom_point(\r\n        data = poblacion, aes(x, y),\r\n        shape = 21, size = 2.2, fill = \"white\",\r\n        color = \"gray80\", stroke = 0.12, alpha = 0.20\r\n      ) +\r\n      geom_point(\r\n        data = m, aes(x, y, fill = color, size = size_pt),\r\n        shape = 21, color = \"gold\", stroke = 0.45, alpha = 0.98\r\n      ) +\r\n      scale_fill_manual(values = cols) +\r\n      scale_size_identity() +\r\n      coord_equal(xlim = xlim_all, ylim = ylim_all, expand = FALSE) +\r\n      labs(title = paste0(\"Muestra (n = \", nrow(m), \")\")) +\r\n      theme_void(base_size = 14) +\r\n      theme(plot.title = element_text(face = \"bold\"),\r\n            legend.position = \"none\")\r\n  })\r\n  \r\n  diam_calc_pob_vi <- reactive({ poblacion$diam_did * ESCALA })\r\n  diam_calc_mue_vi <- reactive({\r\n    m <- muestra_cuanti_vi()\r\n    req(nrow(m) > 0)\r\n    m$diam_did * ESCALA\r\n  })\r\n  \r\n  output$histPob_cuanti_vi <- renderPlot({\r\n    hist_con_normal(diam_calc_pob_vi(), \"Poblaci√≥n: histograma del di√°metro\")\r\n  })\r\n  \r\n  output$histMue_cuanti_vi <- renderPlot({\r\n    hist_con_normal(diam_calc_mue_vi(), \"Muestra: histograma del di√°metro\")\r\n  })\r\n  \r\n  output$tablaMediaVar_cuanti_vi <- renderUI({\r\n    x_p <- diam_calc_pob_vi()\r\n    x_m <- diam_calc_mue_vi()\r\n    \r\n    df <- data.frame(\r\n      Estad√≠stico = c(\"Media\", \"Varianza\"),\r\n      Poblaci√≥n = c(mean(x_p), var(x_p)),\r\n      Muestra = c(mean(x_m), var(x_m)),\r\n      stringsAsFactors = FALSE\r\n    )\r\n    \r\n    tags$div(\r\n      class = \"result-box\",\r\n      tags$h4(\"Comparaci√≥n: media y varianza del di√°metro\", style=\"margin-top:0;\"),\r\n      tags$table(\r\n        style = \"width:100%; border-collapse:collapse;\",\r\n        tags$thead(\r\n          tags$tr(\r\n            tags$th(\"Medidas centrales y de dispersi√≥n\", style=\"text-align:left; border-bottom:2px solid #cfe3ff; padding:6px;\"),\r\n            tags$th(\"Poblaci√≥n\", style=\"text-align:right; border-bottom:2px solid #cfe3ff; padding:6px;\"),\r\n            tags$th(\"Muestra\", style=\"text-align:right; border-bottom:2px solid #cfe3ff; padding:6px;\")\r\n          )\r\n        ),\r\n        tags$tbody(\r\n          lapply(seq_len(nrow(df)), function(i) {\r\n            tags$tr(\r\n              tags$td(df$Estad√≠stico[i], style=\"padding:6px; border-bottom:1px solid #e6f0ff;\"),\r\n              tags$td(sprintf(\"%.3f\", df$Poblaci√≥n[i]), style=\"padding:6px; text-align:right; border-bottom:1px solid #e6f0ff;\"),\r\n              tags$td(sprintf(\"%.3f\", df$Muestra[i]), style=\"padding:6px; text-align:right; border-bottom:1px solid #e6f0ff;\")\r\n            )\r\n          })\r\n        )\r\n      )\r\n    )\r\n  })\r\n  \r\n  # ==========================================================\r\n  # VII. MUESTREO ALEATORIO (tal cual ya lo ten√≠as)\r\n  # ==========================================================\r\n  observe({\r\n    req(!is.null(input$tipo_var_vii))\r\n    if (input$tipo_var_vii == \"cuanti\") {\r\n      v0 <- var(diam_calc_pob())\r\n      updateSliderInput(\r\n        session, \"var_pob_vii\",\r\n        min = max(0.10, v0 * 0.20),\r\n        max = max(0.50, v0 * 3.00),\r\n        value = v0,\r\n        step = 0.10\r\n      )\r\n    }\r\n  })\r\n  \r\n  z_vii <- reactive({\r\n    conf <- input$conf_vii / 100\r\n    qnorm(1 - (1 - conf) / 2)\r\n  })\r\n  \r\n  n_vii <- reactive({\r\n    Z <- z_vii()\r\n    Nn <- N\r\n    \r\n    if (input$tipo_var_vii == \"cuali\") {\r\n      E <- input$err_vii / 100\r\n      p <- 0.5; q <- 0.5\r\n      num <- Nn * (Z^2) * p * q\r\n      den <- (Nn - 1) * (E^2) + (Z^2) * p * q\r\n      n <- ceiling(num / den)\r\n    } else {\r\n      S2 <- input$var_pob_vii\r\n      mu_p <- mean(diam_calc_pob())\r\n      E_abs <- mu_p * (input$err_vii / 100)\r\n      num <- Nn * (Z^2) * S2\r\n      den <- (Nn - 1) * (E_abs^2) + (Z^2) * S2\r\n      n <- ceiling(num / den)\r\n    }\r\n    \r\n    max(10, min(n, Nn))\r\n  })\r\n  \r\n  output$vii_formula <- renderUI({\r\n    if (input$tipo_var_vii == \"cuali\") {\r\n      withMathJax(\r\n        tags$div(class = \"formula-box\",\r\n                 tags$h4(\"F√≥rmula (poblaci√≥n finita)\"),\r\n                 HTML(\"$$n = \\\\frac{N\\\\,Z^2\\\\,p\\\\,q}{(N-1)\\\\,E^2 + Z^2\\\\,p\\\\,q}$$\"))\r\n      )\r\n    } else {\r\n      withMathJax(\r\n        tags$div(class = \"formula-box\",\r\n                 tags$h4(\"F√≥rmula (poblaci√≥n finita)\"),\r\n                 HTML(\"$$n = \\\\frac{N\\\\,Z^2\\\\,S^2}{(N-1)\\\\,E^2 + Z^2\\\\,S^2}$$\"))\r\n      )\r\n    }\r\n  })\r\n  \r\n  output$vii_valores <- renderUI({\r\n    Z <- z_vii()\r\n    Nn <- N\r\n    \r\n    if (input$tipo_var_vii == \"cuali\") {\r\n      p <- 0.5; q <- 0.5\r\n      E <- input$err_vii / 100\r\n      tags$div(class = \"formula-box\",\r\n               tags$h4(\"Valores sustituidos\"),\r\n               tags$ul(\r\n                 tags$li(HTML(paste0(\"<b>N<\/b> = \", Nn))),\r\n                 tags$li(HTML(paste0(\"<b>Z<\/b> = \", sprintf(\"%.3f\", Z), \" (\", input$conf_vii, \"%)\"))),\r\n                 tags$li(HTML(paste0(\"<b>p<\/b> = \", sprintf(\"%.2f\", p), \" ; <b>q<\/b> = \", sprintf(\"%.2f\", q)))),\r\n                 tags$li(HTML(paste0(\"<b>E<\/b> = \", sprintf(\"%.3f\", E))))\r\n               ),\r\n               tags$hr(style=\"margin:8px 0;\"),\r\n               tags$h4(HTML(paste0(\"Tama√±o de muestra calculado: <b>n = \", n_vii(), \"<\/b>\")))\r\n      )\r\n    } else {\r\n      S2 <- input$var_pob_vii\r\n      mu_p <- mean(diam_calc_pob())\r\n      E_abs <- mu_p * (input$err_vii / 100)\r\n      tags$div(class = \"formula-box\",\r\n               tags$h4(\"Valores sustituidos\"),\r\n               tags$ul(\r\n                 tags$li(HTML(paste0(\"<b>N<\/b> = \", Nn))),\r\n                 tags$li(HTML(paste0(\"<b>Z<\/b> = \", sprintf(\"%.3f\", Z), \" (\", input$conf_vii, \"%)\"))),\r\n                 tags$li(HTML(paste0(\"<b>S¬≤<\/b> = \", sprintf(\"%.3f\", S2)))),\r\n                 tags$li(HTML(paste0(\"<b>E<\/b> = \", sprintf(\"%.3f\", E_abs))))\r\n               ),\r\n               tags$hr(style=\"margin:8px 0;\"),\r\n               tags$h4(HTML(paste0(\"Tama√±o de muestra calculado: <b>n = \", n_vii(), \"<\/b>\")))\r\n      )\r\n    }\r\n  })\r\n  \r\n  sample_ids_vii <- reactiveVal(integer(0))\r\n  tomar_muestra_vii <- function() {\r\n    n <- min(n_vii(), N)\r\n    sample_ids_vii(sample(poblacion$id, size = n, replace = FALSE))\r\n  }\r\n  observeEvent(TRUE, { tomar_muestra_vii() }, once = TRUE)\r\n  \r\n  observeEvent(\r\n    c(input$tipo_var_vii, input$conf_vii, input$err_vii, input$var_pob_vii),\r\n    { tomar_muestra_vii() },\r\n    ignoreInit = TRUE\r\n  )\r\n  observeEvent(input$vii_nueva_muestra, { tomar_muestra_vii() }, ignoreInit = TRUE)\r\n  \r\n  muestra_vii <- reactive({\r\n    ids <- sample_ids_vii()\r\n    req(length(ids) > 0)\r\n    poblacion[match(ids, poblacion$id), , drop = FALSE]\r\n  })\r\n  \r\n  output$poblacionPlot_cuali_vii <- renderPlot({ plot_poblacion_bolas(paste0(\"Poblaci√≥n (N = \", N, \")\")) })\r\n  output$muestraPlot_cuali_vii <- renderPlot({\r\n    m <- muestra_vii(); req(nrow(m) > 0)\r\n    ggplot() +\r\n      geom_point(data = poblacion, aes(x, y), shape = 21, size = 2.2, fill = \"white\",\r\n                 color = \"gray80\", stroke = 0.12, alpha = 0.20) +\r\n      geom_point(data = m, aes(x, y, fill = color, size = size_pt), shape = 21,\r\n                 color = \"gray15\", stroke = 0.20, alpha = 0.98) +\r\n      scale_fill_manual(values = cols) + scale_size_identity() +\r\n      coord_equal(xlim = xlim_all, ylim = ylim_all, expand = FALSE) +\r\n      labs(title = paste0(\"Muestra (n = \", nrow(m), \")\")) +\r\n      theme_void(base_size = 14) +\r\n      theme(plot.title = element_text(face = \"bold\"), legend.position = \"none\")\r\n  })\r\n  \r\n  props_cuali_vii_df <- reactive({\r\n    m <- muestra_vii(); req(nrow(m) > 0)\r\n    pob_tab <- prop.table(table(poblacion$color))\r\n    mue_tab <- prop.table(table(m$color))\r\n    colores_all <- levels(poblacion$color)\r\n    pob_tab <- pob_tab[colores_all]\r\n    mue_tab <- mue_tab[colores_all]\r\n    mue_tab[is.na(mue_tab)] <- 0\r\n    data.frame(categoria = colores_all, poblacion = as.numeric(pob_tab), muestra = as.numeric(mue_tab),\r\n               stringsAsFactors = FALSE)\r\n  })\r\n  \r\n  output$donaPob_cuali_vii <- renderPlot({\r\n    df <- props_cuali_vii_df()\r\n    donut_plot(data.frame(categoria=df$categoria, poblacion=df$poblacion), \"poblacion\",\r\n               \"Proporci√≥n poblacional (por color)\")\r\n  })\r\n  output$donaMue_cuali_vii <- renderPlot({\r\n    df <- props_cuali_vii_df()\r\n    donut_plot(data.frame(categoria=df$categoria, muestra=df$muestra), \"muestra\",\r\n               \"Proporci√≥n muestral (por color)\")\r\n  })\r\n  output$tablaProps_cuali_vii <- renderUI({\r\n    df <- props_cuali_vii_df()\r\n    tags$div(\r\n      class = \"result-box\",\r\n      tags$h4(\"Comparaci√≥n: proporci√≥n poblacional vs proporci√≥n muestral\", style=\"margin-top:0;\"),\r\n      tags$table(\r\n        style = \"width:100%; border-collapse:collapse;\",\r\n        tags$thead(tags$tr(\r\n          tags$th(\"Categor√≠a (color)\", style=\"text-align:left; border-bottom:2px solid #cfe3ff; padding:6px;\"),\r\n          tags$th(\"Poblaci√≥n\", style=\"text-align:right; border-bottom:2px solid #cfe3ff; padding:6px;\"),\r\n          tags$th(\"Muestra\", style=\"text-align:right; border-bottom:2px solid #cfe3ff; padding:6px;\")\r\n        )),\r\n        tags$tbody(lapply(seq_len(nrow(df)), function(i) {\r\n          tags$tr(\r\n            tags$td(df$categoria[i], style=\"padding:6px; border-bottom:1px solid #e6f0ff;\"),\r\n            tags$td(sprintf(\"%.3f\", df$poblacion[i]), style=\"padding:6px; text-align:right; border-bottom:1px solid #e6f0ff;\"),\r\n            tags$td(sprintf(\"%.3f\", df$muestra[i]), style=\"padding:6px; text-align:right; border-bottom:1px solid #e6f0ff;\")\r\n          )\r\n        }))\r\n      )\r\n    )\r\n  })\r\n  output$tabla_muestra_vii_cuali <- renderTable({\r\n    m <- muestra_vii(); req(nrow(m) > 0)\r\n    data.frame(ID = as.integer(m$id), Color = as.character(m$color), stringsAsFactors = FALSE)\r\n  }, striped = TRUE, bordered = TRUE, spacing = \"xs\", rownames = FALSE, align = \"c\")\r\n  \r\n  output$poblacionPlot_cuanti_vii <- renderPlot({ plot_poblacion_bolas(paste0(\"Poblaci√≥n (N = \", N, \")\")) })\r\n  output$muestraPlot_cuanti_vii <- renderPlot({\r\n    m <- muestra_vii(); req(nrow(m) > 0)\r\n    ggplot() +\r\n      geom_point(data = poblacion, aes(x, y), shape = 21, size = 2.2, fill = \"white\",\r\n                 color = \"gray80\", stroke = 0.12, alpha = 0.20) +\r\n      geom_point(data = m, aes(x, y, fill = color, size = size_pt), shape = 21,\r\n                 color = \"gold\", stroke = 0.45, alpha = 0.98) +\r\n      scale_fill_manual(values = cols) + scale_size_identity() +\r\n      coord_equal(xlim = xlim_all, ylim = ylim_all, expand = FALSE) +\r\n      labs(title = paste0(\"Muestra (n = \", nrow(m), \")\")) +\r\n      theme_void(base_size = 14) +\r\n      theme(plot.title = element_text(face = \"bold\"), legend.position = \"none\")\r\n  })\r\n  \r\n  diam_calc_pob_vii <- reactive({ poblacion$diam_did * ESCALA })\r\n  diam_calc_mue_vii <- reactive({\r\n    m <- muestra_vii(); req(nrow(m) > 0)\r\n    m$diam_did * ESCALA\r\n  })\r\n  output$histPob_cuanti_vii <- renderPlot({ hist_con_normal(diam_calc_pob_vii(), \"Poblaci√≥n: histograma del di√°metro\") })\r\n  output$histMue_cuanti_vii <- renderPlot({ hist_con_normal(diam_calc_mue_vii(), \"Muestra: histograma del di√°metro\") })\r\n  \r\n  output$tablaMediaVar_cuanti_vii <- renderUI({\r\n    x_p <- diam_calc_pob_vii()\r\n    x_m <- diam_calc_mue_vii()\r\n    df <- data.frame(\r\n      Estad√≠stico = c(\"Media\", \"Varianza\"),\r\n      Poblaci√≥n = c(mean(x_p), var(x_p)),\r\n      Muestra = c(mean(x_m), var(x_m)),\r\n      stringsAsFactors = FALSE\r\n    )\r\n    tags$div(\r\n      class = \"result-box\",\r\n      tags$h4(\"Comparaci√≥n: media y varianza del di√°metro\", style=\"margin-top:0;\"),\r\n      tags$table(\r\n        style = \"width:100%; border-collapse:collapse;\",\r\n        tags$thead(tags$tr(\r\n          tags$th(\"Estad√≠stico\", style=\"text-align:left; border-bottom:2px solid #cfe3ff; padding:6px;\"),\r\n          tags$th(\"Poblaci√≥n\", style=\"text-align:right; border-bottom:2px solid #cfe3ff; padding:6px;\"),\r\n          tags$th(\"Muestra\", style=\"text-align:right; border-bottom:2px solid #cfe3ff; padding:6px;\")\r\n        )),\r\n        tags$tbody(lapply(seq_len(nrow(df)), function(i) {\r\n          tags$tr(\r\n            tags$td(df$Estad√≠stico[i], style=\"padding:6px; border-bottom:1px solid #e6f0ff;\"),\r\n            tags$td(sprintf(\"%.3f\", df$Poblaci√≥n[i]), style=\"padding:6px; text-align:right; border-bottom:1px solid #e6f0ff;\"),\r\n            tags$td(sprintf(\"%.3f\", df$Muestra[i]), style=\"padding:6px; text-align:right; border-bottom:1px solid #e6f0ff;\")\r\n          )\r\n        }))\r\n      )\r\n    )\r\n  })\r\n  \r\n  output$tabla_muestra_vii_cuanti <- renderTable({\r\n    m <- muestra_vii(); req(nrow(m) > 0)\r\n    data.frame(ID = as.integer(m$id), Diametro = round(m$diam_did * ESCALA, 3), stringsAsFactors = FALSE)\r\n  }, striped = TRUE, bordered = TRUE, spacing = \"xs\", rownames = FALSE, align = \"c\")\r\n  \r\n  muestra_export_vii <- reactive({\r\n    m <- muestra_vii(); req(nrow(m) > 0)\r\n    if (input$tipo_var_vii == \"cuali\") {\r\n      data.frame(ID = as.integer(m$id), Color = as.character(m$color), stringsAsFactors = FALSE)\r\n    } else {\r\n      data.frame(ID = as.integer(m$id), Diametro = round(m$diam_did * ESCALA, 3), stringsAsFactors = FALSE)\r\n    }\r\n  })\r\n  observeEvent(input$vii_descargar_csv, {\r\n    df <- muestra_export_vii()\r\n    req(nrow(df) > 0)\r\n    \r\n    csv_txt <- paste(capture.output(write.csv(df, row.names = FALSE, fileEncoding = \"UTF-8\")), collapse = \"\\n\")\r\n    \r\n    session$sendCustomMessage(\"download_text_file\", list(\r\n      filename = paste0(\"muestra_vii_\", Sys.Date(), \".csv\"),\r\n      content  = csv_txt,\r\n      mime     = \"text/csv;charset=utf-8\"\r\n    ))\r\n  })\r\n  \r\n  # ==========================================================\r\n  # VIII. AN√ÅLISIS DESCRIPTIVO E INFERENCIA (solo muestra)  ‚úÖ\r\n  # ==========================================================\r\n  observe({\r\n    req(!is.null(input$tipo_var_viii))\r\n    if (input$tipo_var_viii == \"cuanti\") {\r\n      v0 <- var(diam_calc_pob())\r\n      updateSliderInput(\r\n        session, \"var_pob_viii\",\r\n        min = max(0.10, v0 * 0.20),\r\n        max = max(0.50, v0 * 3.00),\r\n        value = v0,\r\n        step = 0.10\r\n      )\r\n    }\r\n  })\r\n  \r\n  z_viii <- reactive({\r\n    conf <- input$conf_viii / 100\r\n    qnorm(1 - (1 - conf) / 2)\r\n  })\r\n  \r\n  n_viii <- reactive({\r\n    Z <- z_viii()\r\n    Nn <- N\r\n    \r\n    if (input$tipo_var_viii == \"cuali\") {\r\n      E <- input$err_viii / 100\r\n      p <- 0.5; q <- 0.5\r\n      num <- Nn * (Z^2) * p * q\r\n      den <- (Nn - 1) * (E^2) + (Z^2) * p * q\r\n      n <- ceiling(num / den)\r\n    } else {\r\n      S2 <- input$var_pob_viii\r\n      mu_p <- mean(diam_calc_pob())\r\n      E_abs <- mu_p * (input$err_viii / 100)\r\n      num <- Nn * (Z^2) * S2\r\n      den <- (Nn - 1) * (E_abs^2) + (Z^2) * S2\r\n      n <- ceiling(num / den)\r\n    }\r\n    \r\n    max(10, min(n, Nn))\r\n  })\r\n  \r\n  output$viii_formula <- renderUI({\r\n    if (input$tipo_var_viii == \"cuali\") {\r\n      withMathJax(\r\n        tags$div(class = \"formula-box\",\r\n                 tags$h4(\"F√≥rmula (poblaci√≥n finita)\"),\r\n                 HTML(\"$$n = \\\\frac{N\\\\,Z^2\\\\,p\\\\,q}{(N-1)\\\\,E^2 + Z^2\\\\,p\\\\,q}$$\"))\r\n      )\r\n    } else {\r\n      withMathJax(\r\n        tags$div(class = \"formula-box\",\r\n                 tags$h4(\"F√≥rmula (poblaci√≥n finita)\"),\r\n                 HTML(\"$$n = \\\\frac{N\\\\,Z^2\\\\,S^2}{(N-1)\\\\,E^2 + Z^2\\\\,S^2}$$\"))\r\n      )\r\n    }\r\n  })\r\n  \r\n  output$viii_valores <- renderUI({\r\n    Z <- z_viii()\r\n    Nn <- N\r\n    \r\n    if (input$tipo_var_viii == \"cuali\") {\r\n      p <- 0.5; q <- 0.5\r\n      E <- input$err_viii / 100\r\n      tags$div(class = \"formula-box\",\r\n               tags$h4(\"Valores sustituidos\"),\r\n               tags$ul(\r\n                 tags$li(HTML(paste0(\"<b>N<\/b> = \", Nn))),\r\n                 tags$li(HTML(paste0(\"<b>Z<\/b> = \", sprintf(\"%.3f\", Z), \" (\", input$conf_viii, \"%)\"))),\r\n                 tags$li(HTML(paste0(\"<b>p<\/b> = \", sprintf(\"%.2f\", p), \" ; <b>q<\/b> = \", sprintf(\"%.2f\", q)))),\r\n                 tags$li(HTML(paste0(\"<b>E<\/b> = \", sprintf(\"%.3f\", E))))\r\n               ),\r\n               tags$hr(style=\"margin:8px 0;\"),\r\n               tags$h4(HTML(paste0(\"Tama√±o de muestra calculado: <b>n = \", n_viii(), \"<\/b>\")))\r\n      )\r\n    } else {\r\n      S2 <- input$var_pob_viii\r\n      mu_p <- mean(diam_calc_pob())\r\n      E_abs <- mu_p * (input$err_viii / 100)\r\n      tags$div(class = \"formula-box\",\r\n               tags$h4(\"Valores sustituidos\"),\r\n               tags$ul(\r\n                 tags$li(HTML(paste0(\"<b>N<\/b> = \", Nn))),\r\n                 tags$li(HTML(paste0(\"<b>Z<\/b> = \", sprintf(\"%.3f\", Z), \" (\", input$conf_viii, \"%)\"))),\r\n                 tags$li(HTML(paste0(\"<b>S¬≤<\/b> = \", sprintf(\"%.3f\", S2)))),\r\n                 tags$li(HTML(paste0(\"<b>E<\/b> = \", sprintf(\"%.3f\", E_abs))))\r\n               ),\r\n               tags$hr(style=\"margin:8px 0;\"),\r\n               tags$h4(HTML(paste0(\"Tama√±o de muestra calculado: <b>n = \", n_viii(), \"<\/b>\")))\r\n      )\r\n    }\r\n  })\r\n  \r\n  output$viii_formulas_stats <- renderUI({\r\n    withMathJax(\r\n      tags$div(class=\"formula-box\",\r\n               tags$h4(\"F√≥rmulas (notaci√≥n matem√°tica)\"),\r\n               HTML(\"\r\n               $$\\\\hat{p}=\\\\frac{x}{n}$$\r\n               $$\\\\bar{x}=\\\\frac{1}{n}\\\\sum_{i=1}^{n}x_i$$\r\n               $$s^2=\\\\frac{1}{n-1}\\\\sum_{i=1}^{n}(x_i-\\\\bar{x})^2$$\r\n               $$s=\\\\sqrt{s^2}$$\r\n               \"))\r\n    )\r\n  })\r\n  \r\n  sample_ids_viii <- reactiveVal(integer(0))\r\n  tomar_muestra_viii <- function() {\r\n    n <- min(n_viii(), N)\r\n    sample_ids_viii(sample(poblacion$id, size = n, replace = FALSE))\r\n  }\r\n  observeEvent(TRUE, { tomar_muestra_viii() }, once = TRUE)\r\n  observeEvent(\r\n    c(input$tipo_var_viii, input$conf_viii, input$err_viii, input$var_pob_viii),\r\n    { tomar_muestra_viii() },\r\n    ignoreInit = TRUE\r\n  )\r\n  observeEvent(input$viii_nueva_muestra, { tomar_muestra_viii() }, ignoreInit = TRUE)\r\n  \r\n  muestra_viii <- reactive({\r\n    ids <- sample_ids_viii()\r\n    req(length(ids) > 0)\r\n    poblacion[match(ids, poblacion$id), , drop = FALSE]\r\n  })\r\n  \r\n  output$muestraPlot_cuali_viii <- renderPlot({\r\n    m <- muestra_viii(); req(nrow(m) > 0)\r\n    ggplot() +\r\n      geom_point(data = poblacion, aes(x, y), shape = 21, size = 2.2, fill = \"white\",\r\n                 color = \"gray80\", stroke = 0.12, alpha = 0.20) +\r\n      geom_point(data = m, aes(x, y, fill = color, size = size_pt), shape = 21,\r\n                 color = \"gray15\", stroke = 0.20, alpha = 0.98) +\r\n      scale_fill_manual(values = cols) +\r\n      scale_size_identity() +\r\n      coord_equal(xlim = xlim_all, ylim = ylim_all, expand = FALSE) +\r\n      labs(title = paste0(\"Muestra (n = \", nrow(m), \")\")) +\r\n      theme_void(base_size = 14) +\r\n      theme(plot.title = element_text(face = \"bold\"),\r\n            legend.position = \"none\")\r\n  })\r\n  \r\n  output$muestraPlot_cuanti_viii <- renderPlot({\r\n    m <- muestra_viii(); req(nrow(m) > 0)\r\n    ggplot() +\r\n      geom_point(data = poblacion, aes(x, y), shape = 21, size = 2.2, fill = \"white\",\r\n                 color = \"gray80\", stroke = 0.12, alpha = 0.20) +\r\n      geom_point(data = m, aes(x, y, fill = color, size = size_pt), shape = 21,\r\n                 color = \"gold\", stroke = 0.45, alpha = 0.98) +\r\n      scale_fill_manual(values = cols) +\r\n      scale_size_identity() +\r\n      coord_equal(xlim = xlim_all, ylim = ylim_all, expand = FALSE) +\r\n      labs(title = paste0(\"Muestra (n = \", nrow(m), \")\")) +\r\n      theme_void(base_size = 14) +\r\n      theme(plot.title = element_text(face = \"bold\"),\r\n            legend.position = \"none\")\r\n  })\r\n  \r\n  resultados_cuali_viii <- reactive({\r\n    m <- muestra_viii(); req(nrow(m) > 0)\r\n    tab <- table(m$color)\r\n    df <- data.frame(\r\n      Color = names(tab),\r\n      Frecuencia = as.integer(tab),\r\n      Proporci√≥n = as.numeric(tab) / sum(tab),\r\n      stringsAsFactors = FALSE\r\n    )\r\n    df[order(df$Color), , drop = FALSE]\r\n  })\r\n  \r\n  output$viii_resultados_cuali <- renderUI({\r\n    df <- resultados_cuali_viii()\r\n    tags$div(\r\n      class = \"result-box\",\r\n      tags$h4(\"Resultados de la muestra: frecuencias y proporciones\", style=\"margin-top:0;\"),\r\n      tags$table(\r\n        style=\"width:100%; border-collapse:collapse;\",\r\n        tags$thead(tags$tr(\r\n          tags$th(\"Color\", style=\"text-align:left; border-bottom:2px solid #cfe3ff; padding:6px;\"),\r\n          tags$th(\"Frecuencia\", style=\"text-align:right; border-bottom:2px solid #cfe3ff; padding:6px;\"),\r\n          tags$th(\"Proporci√≥n\", style=\"text-align:right; border-bottom:2px solid #cfe3ff; padding:6px;\")\r\n        )),\r\n        tags$tbody(lapply(seq_len(nrow(df)), function(i) {\r\n          tags$tr(\r\n            tags$td(df$Color[i], style=\"padding:6px; border-bottom:1px solid #e6f0ff;\"),\r\n            tags$td(df$Frecuencia[i], style=\"padding:6px; text-align:right; border-bottom:1px solid #e6f0ff;\"),\r\n            tags$td(sprintf(\"%.3f\", df$Proporci√≥n[i]), style=\"padding:6px; text-align:right; border-bottom:1px solid #e6f0ff;\")\r\n          )\r\n        }))\r\n      )\r\n    )\r\n  })\r\n  \r\n  output$viii_ic_cuali <- renderUI({\r\n    m <- muestra_viii(); req(nrow(m) > 0)\r\n    n <- nrow(m)\r\n    Z <- z_viii()\r\n    f <- fpc(N, n)\r\n    \r\n    df <- resultados_cuali_viii()\r\n    df$SE <- sqrt(df$Proporci√≥n * (1 - df$Proporci√≥n) / n) * f\r\n    df$LI <- pmax(0, df$Proporci√≥n - Z * df$SE)\r\n    df$LS <- pmin(1, df$Proporci√≥n + Z * df$SE)\r\n    \r\n    tags$div(\r\n      class=\"result-box\",\r\n      tags$h4(\"Intervalos de confianza para las proporciones (muestra)\", style=\"margin-top:0;\"),\r\n      withMathJax(HTML(\"$$\\\\hat{p} \\\\pm Z\\\\sqrt{\\\\frac{\\\\hat{p}(1-\\\\hat{p})}{n}}\\\\cdot \\\\sqrt{\\\\frac{N-n}{N-1}}$$\")),\r\n      tags$table(\r\n        style=\"width:100%; border-collapse:collapse;\",\r\n        tags$thead(tags$tr(\r\n          tags$th(\"Color\", style=\"text-align:left; border-bottom:2px solid #cfe3ff; padding:6px;\"),\r\n          tags$th(\"pÃÇ\", style=\"text-align:right; border-bottom:2px solid #cfe3ff; padding:6px;\"),\r\n          tags$th(\"LI\", style=\"text-align:right; border-bottom:2px solid #cfe3ff; padding:6px;\"),\r\n          tags$th(\"LS\", style=\"text-align:right; border-bottom:2px solid #cfe3ff; padding:6px;\")\r\n        )),\r\n        tags$tbody(lapply(seq_len(nrow(df)), function(i) {\r\n          tags$tr(\r\n            tags$td(df$Color[i], style=\"padding:6px; border-bottom:1px solid #e6f0ff;\"),\r\n            tags$td(sprintf(\"%.3f\", df$Proporci√≥n[i]), style=\"padding:6px; text-align:right; border-bottom:1px solid #e6f0ff;\"),\r\n            tags$td(sprintf(\"%.3f\", df$LI[i]), style=\"padding:6px; text-align:right; border-bottom:1px solid #e6f0ff;\"),\r\n            tags$td(sprintf(\"%.3f\", df$LS[i]), style=\"padding:6px; text-align:right; border-bottom:1px solid #e6f0ff;\")\r\n          )\r\n        }))\r\n      )\r\n    )\r\n  })\r\n  \r\n  output$tabla_muestra_viii_cuali <- renderTable({\r\n    m <- muestra_viii(); req(nrow(m) > 0)\r\n    data.frame(ID = as.integer(m$id), Color = as.character(m$color), stringsAsFactors = FALSE)\r\n  }, striped = TRUE, bordered = TRUE, spacing = \"xs\", rownames = FALSE, align = \"c\")\r\n  \r\n  x_mue_viii <- reactive({\r\n    m <- muestra_viii(); req(nrow(m) > 0)\r\n    m$diam_did * ESCALA\r\n  })\r\n  \r\n  output$viii_resultados_cuanti <- renderUI({\r\n    x <- x_mue_viii()\r\n    q <- quantile(x, probs = c(0.25, 0.50, 0.75), names = FALSE)\r\n    df <- data.frame(\r\n      Estad√≠stico = c(\"n\", \"Media\", \"Varianza\", \"Desv. est√°ndar\", \"Q1\", \"Mediana (Q2)\", \"Q3\", \"Sesgo\", \"Curtosis (exceso)\"),\r\n      Valor = c(length(x), mean(x), var(x), sd(x), q[1], q[2], q[3], skewness_simple(x), kurtosis_excess_simple(x)),\r\n      stringsAsFactors = FALSE\r\n    )\r\n    tags$div(\r\n      class = \"result-box\",\r\n      tags$h4(\"Resultados de la muestra: estad√≠sticos descriptivos\", style=\"margin-top:0;\"),\r\n      tags$table(\r\n        style=\"width:100%; border-collapse:collapse;\",\r\n        tags$thead(tags$tr(\r\n          tags$th(\"Estad√≠stico\", style=\"text-align:left; border-bottom:2px solid #cfe3ff; padding:6px;\"),\r\n          tags$th(\"Valor\", style=\"text-align:right; border-bottom:2px solid #cfe3ff; padding:6px;\")\r\n        )),\r\n        tags$tbody(lapply(seq_len(nrow(df)), function(i) {\r\n          tags$tr(\r\n            tags$td(df$Estad√≠stico[i], style=\"padding:6px; border-bottom:1px solid #e6f0ff;\"),\r\n            tags$td(sprintf(\"%.4f\", as.numeric(df$Valor[i])),\r\n                    style=\"padding:6px; text-align:right; border-bottom:1px solid #e6f0ff;\")\r\n          )\r\n        }))\r\n      )\r\n    )\r\n  })\r\n  \r\n  output$viii_ic_cuanti <- renderUI({\r\n    x <- x_mue_viii()\r\n    n <- length(x)\r\n    conf <- input$conf_viii / 100\r\n    alpha <- 1 - conf\r\n    tcrit <- qt(1 - alpha/2, df = n - 1)\r\n    f <- fpc(N, n)\r\n    se <- sd(x) / sqrt(n) * f\r\n    li <- mean(x) - tcrit * se\r\n    ls <- mean(x) + tcrit * se\r\n    \r\n    tags$div(\r\n      class=\"result-box\",\r\n      tags$h4(\"Intervalo de confianza para la media (muestra)\", style=\"margin-top:0;\"),\r\n      withMathJax(HTML(\"$$\\\\bar{x} \\\\pm t_{\\\\alpha/2,\\\\,n-1}\\\\,\\\\frac{s}{\\\\sqrt{n}}\\\\cdot \\\\sqrt{\\\\frac{N-n}{N-1}}$$\")),\r\n      tags$table(\r\n        style=\"width:100%; border-collapse:collapse;\",\r\n        tags$thead(tags$tr(\r\n          tags$th(\"xÃÑ\", style=\"text-align:right; border-bottom:2px solid #cfe3ff; padding:6px;\"),\r\n          tags$th(\"LI\", style=\"text-align:right; border-bottom:2px solid #cfe3ff; padding:6px;\"),\r\n          tags$th(\"LS\", style=\"text-align:right; border-bottom:2px solid #cfe3ff; padding:6px;\")\r\n        )),\r\n        tags$tbody(tags$tr(\r\n          tags$td(sprintf(\"%.4f\", mean(x)), style=\"padding:6px; text-align:right; border-bottom:1px solid #e6f0ff;\"),\r\n          tags$td(sprintf(\"%.4f\", li), style=\"padding:6px; text-align:right; border-bottom:1px solid #e6f0ff;\"),\r\n          tags$td(sprintf(\"%.4f\", ls), style=\"padding:6px; text-align:right; border-bottom:1px solid #e6f0ff;\")\r\n        ))\r\n      )\r\n    )\r\n  })\r\n  \r\n  output$tabla_muestra_viii_cuanti <- renderTable({\r\n    m <- muestra_viii(); req(nrow(m) > 0)\r\n    data.frame(ID = as.integer(m$id), Diametro = round(m$diam_did * ESCALA, 3), stringsAsFactors = FALSE)\r\n  }, striped = TRUE, bordered = TRUE, spacing = \"xs\", rownames = FALSE, align = \"c\")\r\n  \r\n  output$donaMue_cuali_viii <- renderPlot({\r\n    m <- muestra_viii(); req(nrow(m) > 0)\r\n    mue_tab <- prop.table(table(m$color))\r\n    colores_all <- levels(poblacion$color)\r\n    mue_tab <- mue_tab[colores_all]\r\n    mue_tab[is.na(mue_tab)] <- 0\r\n    \r\n    df <- data.frame(\r\n      categoria = colores_all,\r\n      muestra = as.numeric(mue_tab),\r\n      stringsAsFactors = FALSE\r\n    )\r\n    \r\n    donut_plot(df, \"muestra\", \"Proporci√≥n muestral (por color)\")\r\n  }) \r\n  \r\n  output$histMue_cuanti_viii <- renderPlot({\r\n    x <- x_mue_viii(); req(length(x) > 0)\r\n    hist_con_normal(x, \"Muestra: histograma del di√°metro\")\r\n  })\r\n  \r\n  # ==========================================================\r\n  # IX. INTERPRETACI√ìN DE LA INFERENCIA (Simulador de cobertura)\r\n  # ==========================================================\r\n  ix_z <- reactive({\r\n    qnorm(1 - (1 - input$ix_conf) / 2)\r\n  })\r\n  \r\n  ix_theta <- reactive({\r\n    if (input$ix_param == \"prop\") {\r\n      mean(poblacion$color == input$ix_color_obj)\r\n    } else {\r\n      mean(poblacion$diam_did * ESCALA)\r\n    }\r\n  })\r\n  \r\n  ix_sigma <- reactive({\r\n    if (input$ix_param == \"prop\") {\r\n      p <- ix_theta()\r\n      sqrt(p * (1 - p))\r\n    } else {\r\n      sd(poblacion$diam_did * ESCALA)\r\n    }\r\n  })\r\n  \r\n  ix_n <- reactive({\r\n    Z <- ix_z()\r\n    sig <- ix_sigma()\r\n    E <- if (input$ix_param == \"prop\") input$ix_E_prop else input$ix_E_med\r\n    \r\n    num <- N * (Z^2) * (sig^2)\r\n    den <- (N - 1) * (E^2) + (Z^2) * (sig^2)\r\n    n <- ceiling(num / den)\r\n    \r\n    max(10, min(n, N))\r\n  })\r\n  \r\n  output$ix_formula <- renderUI({\r\n    if (input$ix_param == \"prop\") {\r\n      withMathJax(\r\n        tags$div(class=\"formula-box\",\r\n                 tags$h4(\"F√≥rmula usada\"),\r\n                 HTML(\"$$n = \\\\frac{N\\\\,Z^2\\\\,\\\\sigma^2}{(N-1)\\\\,E^2 + Z^2\\\\,\\\\sigma^2},\\\\quad \\\\sigma=\\\\sqrt{\\\\pi(1-\\\\pi)}$$\"))\r\n      )\r\n    } else {\r\n      withMathJax(\r\n        tags$div(class=\"formula-box\",\r\n                 tags$h4(\"F√≥rmula usada\"),\r\n                 HTML(\"$$n = \\\\frac{N\\\\,Z^2\\\\,\\\\sigma^2}{(N-1)\\\\,E^2 + Z^2\\\\,\\\\sigma^2}$$\"))\r\n      )\r\n    }\r\n  })\r\n  \r\n  output$ix_sustitucion <- renderUI({\r\n    Z <- ix_z()\r\n    sig <- ix_sigma()\r\n    E <- if (input$ix_param == \"prop\") input$ix_E_prop else input$ix_E_med\r\n    theta <- ix_theta()\r\n    \r\n    tags$div(\r\n      class=\"formula-box\",\r\n      tags$h4(\"Valores sustituidos\"),\r\n      tags$ul(\r\n        tags$li(HTML(paste0(\"<b>N<\/b> = \", N))),\r\n        tags$li(HTML(paste0(\"<b>Z<\/b> = \", sprintf(\"%.3f\", Z), \" (\", round(input$ix_conf*100), \"%)\"))),\r\n        tags$li(HTML(paste0(\"<b>œÉ<\/b> = \", sprintf(\"%.4f\", sig)))),\r\n        tags$li(HTML(paste0(\"<b>E<\/b> = \", sprintf(\"%.4f\", E)))),\r\n        tags$li(HTML(paste0(\"<b>Par√°metro poblacional<\/b> = \", sprintf(\"%.4f\", theta))))\r\n      )\r\n    )\r\n  })\r\n  \r\n  output$ix_n_txt <- renderUI({\r\n    tags$div(class=\"result-box\",\r\n             tags$h4(HTML(paste0(\"Tama√±o de muestra calculado: <b>n = \", ix_n(), \"<\/b>\")),\r\n                     style=\"margin-top:0;\"))\r\n  })\r\n  \r\n  ix_trigger <- reactiveVal(0)\r\n  observeEvent(input$ix_recalcular, {\r\n    ix_trigger(ix_trigger() + 1)\r\n  })\r\n  \r\n  ix_intervalos <- reactive({\r\n    ix_trigger()\r\n    \r\n    B <- as.integer(input$ix_B)\r\n    n <- as.integer(ix_n())\r\n    theta <- ix_theta()\r\n    \r\n    lower <- upper <- numeric(B)\r\n    \r\n    if (input$ix_param == \"prop\") {\r\n      Z <- ix_z()\r\n      y <- as.integer(poblacion$color == input$ix_color_obj)\r\n      f <- fpc(N, n)\r\n      \r\n      for (i in seq_len(B)) {\r\n        idx <- sample.int(N, n, replace = FALSE)\r\n        phat <- mean(y[idx])\r\n        e <- Z * sqrt(phat * (1 - phat) / n) * f\r\n        lower[i] <- phat - e\r\n        upper[i] <- phat + e\r\n      }\r\n      lower <- pmax(0, lower); upper <- pmin(1, upper)\r\n      \r\n    } else {\r\n      conf <- input$ix_conf\r\n      alpha <- 1 - conf\r\n      tcrit <- qt(1 - alpha/2, df = n - 1)\r\n      x <- poblacion$diam_did * ESCALA\r\n      f <- fpc(N, n)\r\n      \r\n      for (i in seq_len(B)) {\r\n        idx <- sample.int(N, n, replace = FALSE)\r\n        xb <- mean(x[idx])\r\n        s <- sd(x[idx])\r\n        e <- tcrit * (s / sqrt(n)) * f\r\n        lower[i] <- xb - e\r\n        upper[i] <- xb + e\r\n      }\r\n    }\r\n    \r\n    cubren <- (lower <= theta) & (upper >= theta)\r\n    list(lower = lower, upper = upper, cubren = cubren, theta = theta, n = n, B = B)\r\n  })\r\n  \r\n  output$ix_plot_ic <- renderPlot({\r\n    obj <- ix_intervalos()\r\n    B <- obj$B\r\n    ylim <- range(c(obj$lower, obj$upper, obj$theta), finite = TRUE)\r\n    \r\n    titulo <- if (input$ix_param == \"prop\") {\r\n      paste0(\"Intervalos de confianza (proporci√≥n)  |  n = \", obj$n, \"  |  B = \", B)\r\n    } else {\r\n      paste0(\"Intervalos de confianza (media)  |  n = \", obj$n, \"  |  B = \", B)\r\n    }\r\n    \r\n    plot(NULL, xlim = c(0, B + 1), ylim = ylim,\r\n         xlab = \"Muestras\", ylab = \"Intervalo\", main = titulo)\r\n    abline(h = obj$theta, col = \"blue\", lwd = 3, lty = 2)\r\n    segments(1:B, obj$lower, 1:B, obj$upper,\r\n             col = ifelse(obj$cubren, \"darkgreen\", \"red\"),\r\n             lwd = if (B <= 100) 2 else 0.8)\r\n  })\r\n  \r\n  output$ix_resumen <- renderUI({\r\n    obj <- ix_intervalos()\r\n    pct <- mean(obj$cubren) * 100\r\n    \r\n    etiqueta_theta <- if (input$ix_param == \"prop\") \"œÄ\" else \"Œº\"\r\n    extra <- if (input$ix_param == \"prop\") {\r\n      paste0(\" (color = \", input$ix_color_obj, \")\")\r\n    } else \"\"\r\n    \r\n    tags$div(\r\n      class=\"result-box\",\r\n      tags$h4(\"Resumen del experimento\", style=\"margin-top:0;\"),\r\n      tags$ul(\r\n        tags$li(HTML(paste0(\"<b>Par√°metro poblacional \", etiqueta_theta, \"<\/b> = \", sprintf(\"%.4f\", obj$theta), extra))),\r\n        tags$li(HTML(paste0(\"<b>n<\/b> = \", obj$n, \" ; <b>B<\/b> = \", obj$B))),\r\n        tags$li(HTML(paste0(\"<b>Porcentaje de intervalos que capturan al par√°metro<\/b> = <b>\", sprintf(\"%.1f\", pct), \"%<\/b>\")))\r\n      )\r\n    )\r\n  })\r\n  \r\n  output$ix_pct_captura <- renderUI({\r\n    obj <- ix_intervalos()\r\n    pct <- mean(obj$cubren) * 100\r\n    \r\n    tags$div(\r\n      class=\"result-box\",\r\n      tags$h4(\"Cobertura emp√≠rica\", style=\"margin-top:0;\"),\r\n      p(HTML(paste0(\"Porcentaje de intervalos que capturan al par√°metro poblacional: <b>\", sprintf(\"%.1f\", pct), \"%<\/b>.\"))),\r\n      p(\"En un experimento ideal, este porcentaje suele estar cerca del nivel de confianza seleccionado, aunque puede variar por azar muestral.\")\r\n    )\r\n  })\r\n  \r\n  # ==========================================================\r\n  # X. GLOSARIO Y SIMBOLOG√çA (integrado)\r\n  # ==========================================================\r\n  output$glosario_ui <- renderUI({\r\n    withMathJax(\r\n      tags$div(\r\n        class = \"glossary-wrap\",\r\n        \r\n        div(\r\n          class = \"result-box\",\r\n          tags$h4(\"Glosario: conceptos, s√≠mbolos y notaci√≥n\", style=\"margin-top:0;\"),\r\n          \r\n          tags$table(\r\n            class = \"glossary-table\",\r\n            tags$thead(\r\n              tags$tr(\r\n                tags$th(\"Concepto\"),\r\n                tags$th(\"S√≠mbolo\"),\r\n                tags$th(\"Descripci√≥n\")\r\n              )\r\n            ),\r\n            tags$tbody(\r\n              \r\n              tags$tr(\r\n                tags$td(HTML(\"<b>Poblaci√≥n o universo<\/b>\")),\r\n                tags$td(withMathJax(HTML(\"\\\\(\\\\Omega\\\\),\\\\ \\\\(N\\\\)\"))),\r\n                tags$td(HTML(\"Conjunto total de individuos con caracter√≠sticas de inter√©s. \\\\(N\\\\) denota el tama√±o de la poblaci√≥n.\"))\r\n              ),\r\n              \r\n              tags$tr(\r\n                tags$td(HTML(\"<b>Variable<\/b>\")),\r\n                tags$td(HTML(\"<span class='math-serif-bold'>X<\/span>\")),\r\n                tags$td(HTML(\"Representa el atributo de inter√©s. <b>Clasificaci√≥n:<\/b> <b>cualitativa<\/b> (categor√≠as) o <b>cuantitativa<\/b> (valores num√©ricos).\"))\r\n              ),\r\n              \r\n              tags$tr(\r\n                tags$td(HTML(\"<b>Par√°metro poblacional (gen√©rico, desconocido)<\/b>\")),\r\n                tags$td(HTML(\"<span class='math-serif-bold'>&theta;<\/span>\")),\r\n                tags$td(\"Valor √∫nico que resume la caracter√≠stica de inter√©s en la poblaci√≥n; generalmente es desconocido y se estima con una muestra.\")\r\n              ),\r\n              \r\n              tags$tr(\r\n                tags$td(HTML(\"<b>Proporci√≥n poblacional<\/b> (si el inter√©s es cualitativo)\")),\r\n                tags$td(HTML(\"<span class='math-serif-bold'>&pi;<\/span>\")),\r\n                tags$td(withMathJax(HTML(\"Par√°metro cuando la variable es cualitativa (√©xito/fracaso). \\\\(\\\\pi\\\\) es la proporci√≥n de ‚Äú√©xitos‚Äù en la poblaci√≥n.\")))\r\n              ),\r\n              \r\n              tags$tr(\r\n                tags$td(HTML(\"<b>Media poblacional<\/b> (si el inter√©s es cuantitativo)\")),\r\n                tags$td(HTML(\"<span class='math-serif-bold'>&mu;<\/span>\")),\r\n                tags$td(withMathJax(HTML(\"Par√°metro cuando la variable es cuantitativa (promedio de la poblaci√≥n).\")))\r\n              ),\r\n              \r\n              tags$tr(\r\n                tags$td(HTML(\"<b>Muestreo<\/b>\")),\r\n                tags$td(withMathJax(HTML(\"\\\\(n\\\\)\"))),\r\n                tags$td(\"Proceso de selecci√≥n aleatoria de unidades de la poblaci√≥n. \\\\(n\\\\) es el tama√±o de la muestra.\")\r\n              ),\r\n              \r\n              tags$tr(\r\n                tags$td(HTML(\"<b>Nivel de confianza<\/b>\")),\r\n                tags$td(withMathJax(HTML(\"\\\\(1-\\\\alpha\\\\)\"))),\r\n                tags$td(\"Probabilidad de √©xito del procedimiento de estimaci√≥n (cobertura a largo plazo).\")\r\n              ),\r\n              \r\n              tags$tr(\r\n                tags$td(HTML(\"<b>Margen de error<\/b>\")),\r\n                tags$td(withMathJax(HTML(\"\\\\(E\\\\)\"))),\r\n                tags$td(\"Medida m√°xima de desviaci√≥n respecto al valor del par√°metro investigado.\")\r\n              ),\r\n              \r\n              tags$tr(\r\n                tags$td(HTML(\"<b>Varianza poblacional<\/b> (para estimar media)\")),\r\n                tags$td(HTML(\"<span class='math-serif-bold'>&sigma;<sup>2<\/sup><\/span>\")),\r\n                tags$td(withMathJax(HTML(\"Medida de dispersi√≥n en la poblaci√≥n. Se usa en el c√°lculo de \\\\(n\\\\) cuando se estima \\\\(\\\\mu\\\\).\")))\r\n              ),\r\n              \r\n              # --- Tama√±o de muestra (FINITA) ---\r\n              tags$tr(\r\n                tags$td(HTML(\"<b>Tama√±o de muestra (proporci√≥n, poblaci√≥n finita)<\/b>\")),\r\n                tags$td(withMathJax(HTML(\"\\\\(n\\\\)\"))),\r\n                tags$td(withMathJax(HTML(\r\n                  \"F√≥rmula: \\\\[\\\\; n = \\\\frac{N\\\\,Z_{\\\\alpha/2}^{2}\\\\,\\\\pi(1-\\\\pi)}{(N-1)\\\\,E^{2} + Z_{\\\\alpha/2}^{2}\\\\,\\\\pi(1-\\\\pi)} \\\\;\\\\]\"\r\n                )))\r\n              ),\r\n              tags$tr(\r\n                tags$td(HTML(\"<b>Tama√±o de muestra (media, poblaci√≥n finita)<\/b>\")),\r\n                tags$td(withMathJax(HTML(\"\\\\(n\\\\)\"))),\r\n                tags$td(withMathJax(HTML(\r\n                  \"F√≥rmula: \\\\[\\\\; n = \\\\frac{N\\\\,Z_{\\\\alpha/2}^{2}\\\\,\\\\sigma^{2}}{(N-1)\\\\,E^{2} + Z_{\\\\alpha/2}^{2}\\\\,\\\\sigma^{2}} \\\\;\\\\]\"\r\n                )))\r\n              ),\r\n              \r\n              tags$tr(\r\n                tags$td(HTML(\"<b>Unidades muestrales<\/b>\")),\r\n                tags$td(withMathJax(HTML(\"\\\\(X_1,\\\\dots,X_n\\\\)\"))),\r\n                tags$td(\"Individuos seleccionados aleatoriamente que conforman la muestra.\")\r\n              ),\r\n              \r\n              tags$tr(\r\n                tags$td(HTML(\"<b>Estad√≠stico (estad√≠grafo)<\/b>\")),\r\n                tags$td(withMathJax(HTML(\"\\\\(t\\\\)\"))),\r\n                tags$td(\"Medida-resumen calculada con la muestra (toma un solo valor). Depende del par√°metro investigado.\")\r\n              ),\r\n              \r\n              tags$tr(\r\n                tags$td(HTML(\"<b>Proporci√≥n muestral<\/b> (si se investiga &pi;)\")),\r\n                tags$td(withMathJax(HTML(\"\\\\(p\\\\)\"))),\r\n                tags$td(withMathJax(HTML(\"\\\\(p=\\\\frac{x}{n}\\\\), donde \\\\(x\\\\) es el n√∫mero de √©xitos observados en la muestra.\")))\r\n              ),\r\n              \r\n              tags$tr(\r\n                tags$td(HTML(\"<b>Media muestral<\/b> (si se investiga &mu;)\")),\r\n                tags$td(withMathJax(HTML(\"\\\\(\\\\bar{x}\\\\)\"))),\r\n                tags$td(withMathJax(HTML(\"\\\\(\\\\bar{x}=\\\\frac{1}{n}\\\\sum_{i=1}^{n}x_i\\\\).\")))\r\n              ),\r\n              \r\n              # --- Mediana ---\r\n              tags$tr(\r\n                tags$td(HTML(\"<b>Mediana<\/b>\")),\r\n                tags$td(withMathJax(HTML(\"\\\\(\\\\tilde{x}\\\\)\"))),\r\n                tags$td(withMathJax(HTML(\r\n                  \"Si \\\\(x_{(1)}\\\\le\\\\cdots\\\\le x_{(n)}\\\\): \\\\[\\\\;\\\\tilde{x}=\\\\begin{cases}x_{\\\\left(\\\\frac{n+1}{2}\\\\right)}, & n\\\\ \\\\text{impar}\\\\\\\\[4pt]\r\n                \\\\frac{x_{\\\\left(\\\\frac{n}{2}\\\\right)}+x_{\\\\left(\\\\frac{n}{2}+1\\\\right)}}{2}, & n\\\\ \\\\text{par}\r\n                \\\\end{cases}\\\\;\\\\]\"\r\n                )))\r\n              ),\r\n              \r\n              # --- Moda ---\r\n              tags$tr(\r\n                tags$td(HTML(\"<b>Moda<\/b>\")),\r\n                tags$td(withMathJax(HTML(\"\\\\(\\\\mathrm{Mo}\\\\)\"))),\r\n                tags$td(withMathJax(HTML(\r\n                  \"Valor con mayor frecuencia observada: \\\\(\\\\mathrm{Mo}=\\\\arg\\\\max_{x}\\\\,f(x)\\\\), donde \\\\(f(x)\\\\) es la frecuencia.\"\r\n                )))\r\n              ),\r\n              \r\n              # --- Cuartil i-√©simo ---\r\n              tags$tr(\r\n                tags$td(HTML(\"<b>Cuartil i-√©simo<\/b>\")),\r\n                tags$td(withMathJax(HTML(\"\\\\(Q_i\\\\)\"))),\r\n                tags$td(withMathJax(HTML(\r\n                  \"Para \\\\(i\\\\in\\\\{1,2,3\\\\}\\\\) y datos ordenados: \\\\[\\\\; Q_i = x_{\\\\left(\\\\lceil \\\\frac{i(n+1)}{4} \\\\rceil\\\\right)} \\\\;\\\\] (regla de posici√≥n; existen variantes equivalentes en la pr√°ctica).\"\r\n                )))\r\n              ),\r\n              \r\n              # --- Varianza muestral ---\r\n              tags$tr(\r\n                tags$td(HTML(\"<b>Varianza muestral<\/b>\")),\r\n                tags$td(withMathJax(HTML(\"\\\\(s^2\\\\)\"))),\r\n                tags$td(withMathJax(HTML(\r\n                  \"\\\\[\\\\; s^2=\\\\frac{1}{n-1}\\\\sum_{i=1}^{n}(x_i-\\\\bar{x})^2 \\\\;\\\\]\"\r\n                )))\r\n              ),\r\n              \r\n              # --- Sesgo ---\r\n              tags$tr(\r\n                tags$td(HTML(\"<b>Sesgo<\/b>\")),\r\n                tags$td(withMathJax(HTML(\"\\\\(g_1\\\\)\"))),\r\n                tags$td(withMathJax(HTML(\r\n                  \"\\\\[\\\\; g_1=\\\\frac{1}{n}\\\\sum_{i=1}^{n}\\\\left(\\\\frac{x_i-\\\\bar{x}}{s}\\\\right)^3 \\\\;\\\\]\"\r\n                )))\r\n              ),\r\n              \r\n              # --- Curtosis (exceso) ---\r\n              tags$tr(\r\n                tags$td(HTML(\"<b>Curtosis<\/b> (exceso)\")),\r\n                tags$td(withMathJax(HTML(\"\\\\(g_2\\\\)\"))),\r\n                tags$td(withMathJax(HTML(\r\n                  \"\\\\[\\\\; g_2=\\\\frac{1}{n}\\\\sum_{i=1}^{n}\\\\left(\\\\frac{x_i-\\\\bar{x}}{s}\\\\right)^4-3 \\\\;\\\\]\"\r\n                )))\r\n              ),\r\n              \r\n              tags$tr(\r\n                tags$td(HTML(\"<b>Inferencia estad√≠stica<\/b>\")),\r\n                tags$td(\"‚Äî\"),\r\n                tags$td(\"Proceso de aproximar par√°metros poblacionales a partir de estad√≠sticos muestrales, cuantificando la incertidumbre.\")\r\n              ),\r\n              \r\n              tags$tr(\r\n                tags$td(HTML(\"<b>Estimador gen√©rico<\/b>\")),\r\n                tags$td(withMathJax(HTML(\"\\\\(\\\\hat{\\\\theta}\\\\)\"))),\r\n                tags$td(\"Aproximaci√≥n de \\\\(\\\\theta\\\\) basada en la muestra.\")\r\n              ),\r\n              \r\n              tags$tr(\r\n                tags$td(HTML(\"<b>Relaci√≥n estimador‚Äìpar√°metro (proporci√≥n)<\/b>\")),\r\n                tags$td(withMathJax(HTML(\"\\\\(\\\\hat{\\\\theta}=p\\\\), \\\\(\\\\hat{\\\\pi}=p\\\\)\"))),\r\n                tags$td(\"Si el par√°metro investigado es \\\\(\\\\pi\\\\), el estimador es la proporci√≥n muestral \\\\(p\\\\).\")\r\n              ),\r\n              \r\n              tags$tr(\r\n                tags$td(HTML(\"<b>Relaci√≥n estimador‚Äìpar√°metro (media)<\/b>\")),\r\n                tags$td(withMathJax(HTML(\"\\\\(\\\\hat{\\\\theta}=\\\\bar{x}\\\\), \\\\(\\\\hat{\\\\mu}=\\\\bar{x}\\\\)\"))),\r\n                tags$td(\"Si el par√°metro investigado es \\\\(\\\\mu\\\\), el estimador es la media muestral \\\\(\\\\bar{x}\\\\).\")\r\n              )\r\n            )\r\n          )\r\n        ),\r\n        \r\n        tags$div(\r\n          class = \"pedagogic-note\",\r\n          tags$div(class = \"title\", \"Ideas clave\"),\r\n          tags$div(class = \"mathline\",\r\n                   withMathJax(HTML(\"\\\\(\\\\textbf{Poblaci√≥n}\\\\;\\\\rightarrow\\\\;\\\\boldsymbol{\\\\theta}\\\\;(\\\\text{desconocido})\\\\)\"))),\r\n          tags$div(class = \"mathline\",\r\n                   withMathJax(HTML(\"\\\\(\\\\textbf{Muestra}\\\\;\\\\rightarrow\\\\;t\\\\;\\\\rightarrow\\\\;\\\\hat{\\\\boldsymbol{\\\\theta}}\\\\)\"))),\r\n          tags$div(\r\n            style=\"margin-top:8px;\",\r\n            tags$ul(\r\n              tags$li(withMathJax(HTML(\"Si se investiga proporci√≥n: \\\\(\\\\hat{\\\\pi}=p\\\\)\"))),\r\n              tags$li(withMathJax(HTML(\"Si se investiga media: \\\\(\\\\hat{\\\\mu}=\\\\bar{x}\\\\)\")))\r\n            )\r\n          )\r\n        )\r\n      )\r\n    )\r\n  })\r\n  \r\n}\r\n\r\nshinyApp(ui, server)","type":"text"}]
